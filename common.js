!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.EPSILON=1e-6;var i=function(){function t(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._keys=[],this._map=new Map(e),this._map.forEach(function(e,n){t._keys.push(n)})}return t.prototype.clear=function(){this._keys.length=0,this._map.clear()},t.prototype.key=function(t){return this._keys[t]},t.prototype.has=function(t){return this._map.has(t)},t.prototype.hasByIndex=function(t){return this.has(this._keys[t])},t.prototype.get=function(t){return this._map.get(t)},t.prototype.getByIndex=function(t){return this.get(this._keys[t])},t.prototype.set=function(t,e){return this._map.has(t)||this._keys.push(t),this._map.set(t,e),e},t.prototype.setByIndex=function(t,e){return this.set(this._keys[t],e)},t.prototype.delete=function(t){this._keys.splice(this._keys.indexOf(t),1),this._map.delete(t)},t.prototype.deleteByIndex=function(t){this.delete(this._keys[t])},t.prototype.forEach=function(t){var e=this;this._keys.forEach(function(n,r,i){var o=e._map.get(n);if(!o)throw new Error;t(o,n,r,e)})},t.prototype.map=function(t){var e=[];return this.forEach(function(n,r,i,o){e.push(t(n,r,i,o))}),e},t.prototype.sortKeys=function(t){this._keys.sort(t)},t}();function o(t,e,n){void 0===n&&(n=!1);var r=t[e];switch(typeof r){case"string":return"true"===r;case"boolean":return r;default:return n}}function a(t,e,n){void 0===n&&(n=0);var r=t[e];switch(typeof r){case"string":return parseFloat(r);case"number":return r;default:return n}}function s(t,e,n,r){void 0===r&&(r=0),"number"==typeof r&&n===r||(t[e]=n)}function c(t,e,n){void 0===n&&(n=0);var r=t[e];switch(typeof r){case"string":return parseInt(r,10);case"number":return 0|r;default:return n}}function h(t,e,n){void 0===n&&(n="");var r=t[e];switch(typeof r){case"string":return r;default:return n}}e.Map=i,e.loadBool=o,e.saveBool=function(t,e,n,r){void 0===r&&(r=!1),"boolean"==typeof r&&n===r||(t[e]=n)},e.loadFloat=a,e.saveFloat=s,e.loadInt=c,e.saveInt=function(t,e,n,r){void 0===r&&(r=0),"number"==typeof r&&n===r||(t[e]=n)},e.loadString=h,e.saveString=function(t,e,n,r){void 0===r&&(r=""),"string"==typeof r&&n===r||(t[e]=n)};var u=function(){function t(){this.r=1,this.g=1,this.b=1,this.a=1}return t.copy=function(e,n){return void 0===n&&(n=new t),n.r=e.r,n.g=e.g,n.b=e.b,n.a=e.a,n},t.prototype.copy=function(e){return t.copy(e,this)},t.prototype.load=function(t,e){void 0===e&&(e=4294967295);var n=e;return"string"==typeof t&&(n=parseInt(t,16)),"number"==typeof t&&(n=0|t),this.r=(n>>24&255)/255,this.g=(n>>16&255)/255,this.b=(n>>8&255)/255,this.a=(255&n)/255,this},t.prototype.toString=function(){return"rgba("+(255*this.r).toFixed(0)+","+(255*this.g).toFixed(0)+","+(255*this.b).toFixed(0)+","+this.a+")"},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),i.r=m(e.r,n.r,r),i.g=m(e.g,n.g,r),i.b=m(e.b,n.b,r),i.a=m(e.a,n.a,r),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();function l(t,e,n,r){var i=.1*.1*.1*6,o=2*-t+n,a=2*-e+r,s=3*(t-n)+1,c=3*(e-r)+1,h=t*(3*.1)+o*(.1*.1*3)+s*(.1*.1*.1),u=e*(3*.1)+a*(.1*.1*3)+c*(.1*.1*.1),l=o*(.1*.1*6)+s*i,f=a*(.1*.1*6)+c*i,p=s*i,d=c*i;return function(t){for(var e=h,n=u,r=l,i=f,o=p,a=d,s=e,c=n,m=8;;){if(s>=t){var _=s-e,v=c-n;return v+(c-v)*(t-_)/(s-_)}if(0===m)break;m--,e+=r,n+=i,r+=o,i+=a,s+=e,c+=n}return c+(1-c)*(t-s)/(1-s)}}e.Color=u,e.BezierCurve=function(t,n,r,i,o){function a(e){var n=e*e,i=1-e;return 3*t*(i*i)*e+3*r*i*n+n*e}function s(t){var e=t*t,r=1-t;return 3*n*(r*r)*t+3*i*r*e+e*t}function c(e){var n=e*e;return 3*t*e-3*(2*t-r)*n+n*e*(3*t-3*r+1)}return void 0===o&&(o=e.EPSILON),function(t){var e,n,r,i,h,u,l=t;for(r=l,u=0;u<8;++u){if(i=a(r)-l,Math.abs(i)<o)return s(r);if(h=c(r),Math.abs(h)<o)break;r-=i/h}if(n=1,(r=l)<(e=0))return s(e);if(r>n)return s(n);for(;e<n;){if(i=a(r),Math.abs(i-l)<o)return s(r);l>i?e=r:n=r,r=.5*(n-e)+e}return s(r)}},e.StepBezierCurve=l;var f=function(){function t(){this.evaluate=function(t){return t}}return t.prototype.load=function(t){if(this.evaluate=function(t){return t},"string"==typeof t&&"stepped"===t)this.evaluate=function(t){return 0};else if("object"==typeof t&&"number"==typeof t.length&&4===t.length){var e=a(t,0,0),n=a(t,1,0),r=a(t,2,1),i=a(t,3,1);this.evaluate=l(e,n,r,i)}return this},t}();function p(t){return t<0?-1:t>0?1:t}function d(t,e,n){return e<n?t<e?n-(e-t)%(n-e):e+(t-e)%(n-e):e===n?e:t}function m(t,e,n){return t+(e-t)*n}function _(t){return t<=0?(t-Math.PI)%(2*Math.PI)+Math.PI:(t+Math.PI)%(2*Math.PI)-Math.PI}function v(t,e,n){return _(t+_(e-t)*n)}e.Curve=f,e.sign=p,e.wrap=d,e.tween=m,e.wrapAngleRadians=_,e.tweenAngleRadians=v;var y=function(){function t(t){void 0===t&&(t=0),this._rad=0,this._cos=1,this._sin=0,this.rad=t}return Object.defineProperty(t.prototype,"rad",{get:function(){return this._rad},set:function(t){this._rad!==t&&(this._rad=t,this._cos=Math.cos(t),this._sin=Math.sin(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deg",{get:function(){return 180*this.rad/Math.PI},set:function(t){this.rad=t*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cos",{get:function(){return this._cos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sin",{get:function(){return this._sin},enumerable:!0,configurable:!0}),t.copy=function(e,n){return void 0===n&&(n=new t),n._rad=e._rad,n._cos=e._cos,n._sin=e._sin,n},t.prototype.copy=function(e){return t.copy(e,this)},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!(Math.abs(_(t.rad-n.rad))>r)},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),i.rad=v(e.rad,n.rad,r),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();e.Angle=y;var g=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.copy=function(e,n){return void 0===n&&(n=new t),n.x=e.x,n.y=e.y,n},t.prototype.copy=function(e){return t.copy(e,this)},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!(Math.abs(t.x-n.x)>r)&&!(Math.abs(t.y-n.y)>r)},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.negate=function(e,n){return void 0===n&&(n=new t),n.x=-e.x,n.y=-e.y,n},t.add=function(e,n,r){return void 0===r&&(r=new t),r.x=e.x+n.x,r.y=e.y+n.y,r},t.prototype.add=function(e,n){return void 0===n&&(n=new t),t.add(this,e,n)},t.prototype.selfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.subtract=function(e,n,r){return void 0===r&&(r=new t),r.x=e.x-n.x,r.y=e.y-n.y,r},t.prototype.subtract=function(e,n){return void 0===n&&(n=new t),t.subtract(this,e,n)},t.prototype.selfSubtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.scale=function(e,n,r,i){return void 0===r&&(r=n),void 0===i&&(i=new t),i.x=e.x*n,i.y=e.y*r,i},t.prototype.scale=function(e,n,r){return void 0===n&&(n=e),void 0===r&&(r=new t),t.scale(this,e,n,r)},t.prototype.selfScale=function(e,n){return void 0===n&&(n=e),t.scale(this,e,n,this)},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),i.x=m(e.x,n.x,r),i.y=m(e.y,n.y,r),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();e.Vector=g;var x=function(){function t(){this.a=1,this.b=0,this.c=0,this.d=1}return t.copy=function(e,n){return void 0===n&&(n=new t),n.a=e.a,n.b=e.b,n.c=e.c,n.d=e.d,n},t.prototype.copy=function(e){return t.copy(e,this)},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!(Math.abs(t.a-n.a)>r)&&(!(Math.abs(t.b-n.b)>r)&&(!(Math.abs(t.c-n.c)>r)&&!(Math.abs(t.d-n.d)>r)))},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.determinant=function(t){return t.a*t.d-t.b*t.c},t.identity=function(e){return void 0===e&&(e=new t),e.a=1,e.b=0,e.c=0,e.d=1,e},t.multiply=function(e,n,r){void 0===r&&(r=new t);var i=e.a,o=e.b,a=e.c,s=e.d,c=n.a,h=n.b,u=n.c,l=n.d;return r.a=i*c+o*u,r.b=i*h+o*l,r.c=a*c+s*u,r.d=a*h+s*l,r},t.invert=function(e,n){void 0===n&&(n=new t);var r=e.a,i=e.b,o=e.c,a=e.d,s=1/(r*a-i*o);return n.a=s*a,n.b=-s*i,n.c=-s*o,n.d=s*r,n},t.combine=function(e,n,r){return t.multiply(e,n,r)},t.extract=function(e,n,r){return t.multiply(t.invert(n,r),e,r)},t.prototype.selfRotate=function(e,n){return t.rotate(this,e,n,this)},t.rotate=function(e,n,r,i){void 0===i&&(i=new t);var o=e.a,a=e.b,s=e.c,c=e.d;return i.a=o*n+a*r,i.b=a*n-o*r,i.c=s*n+c*r,i.d=c*n-s*r,i},t.scale=function(e,n,r,i){return void 0===i&&(i=new t),i.a=e.a*n,i.b=e.b*r,i.c=e.c*n,i.d=e.d*r,i},t.transform=function(t,e,n){void 0===n&&(n=new g);var r=e.x,i=e.y;return n.x=t.a*r+t.b*i,n.y=t.c*r+t.d*i,n},t.untransform=function(t,e,n){void 0===n&&(n=new g);var r=t.a,i=t.b,o=t.c,a=t.d,s=e.x,c=e.y,h=1/(r*a-i*o);return n.x=h*(a*s-i*c),n.y=h*(r*c-o*s),n},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),i.a=m(e.a,n.a,r),i.b=m(e.b,n.b,r),i.c=m(e.c,n.c,r),i.d=m(e.d,n.d,r),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();e.Matrix=x;var w=function(){function t(){this.vector=new g,this.matrix=new x}return t.copy=function(e,n){return void 0===n&&(n=new t),g.copy(e.vector,n.vector),x.copy(e.matrix,n.matrix),n},t.prototype.copy=function(e){return t.copy(e,this)},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!!t.vector.equal(n.vector,r)&&!!t.matrix.equal(n.matrix,r)},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.identity=function(e){return void 0===e&&(e=new t),x.identity(e.matrix),e.vector.x=0,e.vector.y=0,e},t.invert=function(e,n){return void 0===n&&(n=new t),x.invert(e.matrix,n.matrix),g.negate(e.vector,n.vector),x.transform(n.matrix,n.vector,n.vector),n},t.combine=function(e,n,r){return void 0===r&&(r=new t),t.transform(e,n.vector,r.vector),x.combine(e.matrix,n.matrix,r.matrix),r},t.extract=function(e,n,r){return void 0===r&&(r=new t),x.extract(e.matrix,n.matrix,r.matrix),t.untransform(n,e.vector,r.vector),r},t.transform=function(t,e,n){return void 0===n&&(n=new g),x.transform(t.matrix,e,n),g.add(t.vector,n,n),n},t.untransform=function(t,e,n){return void 0===n&&(n=new g),g.subtract(e,t.vector,n),x.untransform(t.matrix,n,n),n},t}();e.Affine=w;var b=function(t){function e(){return t.call(this,0,0)||this}return r(e,t),e}(g);e.Position=b;var k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.matrix=new x,e}return r(e,t),e.prototype.updateMatrix=function(t){return void 0===t&&(t=this.matrix),t.a=this.cos,t.b=-this.sin,t.c=this.sin,t.d=this.cos,t},e}(y);e.Rotation=k;var E=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),Object.defineProperty(n.prototype,"x",{get:function(){return Math.abs(this.c)<e.EPSILON?this.a:p(this.a)*Math.sqrt(this.a*this.a+this.c*this.c)},set:function(t){this.a=t,this.c=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return Math.abs(this.b)<e.EPSILON?this.d:p(this.d)*Math.sqrt(this.b*this.b+this.d*this.d)},set:function(t){this.b=0,this.d=t},enumerable:!0,configurable:!0}),n}(x);e.Scale=E;var A=function(){function t(){this.x=new y,this.y=new y,this.matrix=new x}return t.prototype.updateMatrix=function(t){return void 0===t&&(t=this.matrix),t.a=this.x.cos,t.b=-this.y.sin,t.c=this.x.sin,t.d=this.y.cos,t},t.copy=function(e,n){return void 0===n&&(n=new t),n.x.copy(e.x),n.y.copy(e.y),n},t.prototype.copy=function(e){return t.copy(e,this)},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!!t.x.equal(n.x,r)&&!!t.y.equal(n.y,r)},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),y.tween(e.x,n.x,r,i.x),y.tween(e.y,n.y,r,i.y),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();e.Shear=A;var T=function(){function t(){this.position=new b,this.rotation=new k,this.scale=new E,this.shear=new A,this.affine=new w}return t.prototype.updateAffine=function(t){return void 0===t&&(t=this.affine),g.copy(this.position,t.vector),x.copy(this.rotation.updateMatrix(),t.matrix),x.multiply(t.matrix,this.shear.updateMatrix(),t.matrix),x.multiply(t.matrix,this.scale,t.matrix),t},t.copy=function(e,n){return void 0===n&&(n=new t),n.position.copy(e.position),n.rotation.copy(e.rotation),n.scale.copy(e.scale),n.shear.copy(e.shear),n},t.prototype.copy=function(e){return t.copy(e,this)},t.prototype.load=function(t){return this.position.x=a(t,"x",0),this.position.y=a(t,"y",0),this.rotation.deg=a(t,"rotation",0),this.scale.x=a(t,"scaleX",1),this.scale.y=a(t,"scaleY",1),this.shear.x.deg=a(t,"shearX",0),this.shear.y.deg=a(t,"shearY",0),this},t.equal=function(t,n,r){return void 0===r&&(r=e.EPSILON),!!t.position.equal(n.position,r)&&(!!t.rotation.equal(n.rotation,r)&&(!!t.scale.equal(n.scale,r)&&!!t.shear.equal(n.shear,r)))},t.prototype.equal=function(n,r){return void 0===r&&(r=e.EPSILON),t.equal(this,n,r)},t.identity=function(e){return void 0===e&&(e=new t),e.position.x=0,e.position.y=0,e.rotation.rad=0,e.scale.x=1,e.scale.y=1,e.shear.x.rad=0,e.shear.y.rad=0,e},t.translate=function(e,n,r){return t.transform(e,new g(n,r),e.position),e},t.rotate=function(t,e){return x.determinant(t.scale)<0?t.rotation.rad=_(t.rotation.rad-e):t.rotation.rad=_(t.rotation.rad+e),t},t.scale=function(t,e,n){return x.scale(t.scale,e,n,t.scale),t},t.invert=function(e,n){void 0===n&&(n=new t),e===n&&(e=t.copy(e,new t)),w.invert(e.updateAffine(),n.affine),n.position.copy(n.affine.vector),n.shear.x.rad=-e.shear.x.rad,n.shear.y.rad=-e.shear.y.rad;var r=Math.atan2(n.affine.matrix.c,n.affine.matrix.a);return n.rotation.rad=_(r-n.shear.x.rad),x.combine(n.rotation.updateMatrix(),n.shear.updateMatrix(),n.scale),x.extract(n.affine.matrix,n.scale,n.scale),n},t.combine=function(e,n,r){void 0===r&&(r=new t),e===r&&(e=t.copy(e,new t)),n===r&&(n=t.copy(n,new t)),w.combine(e.updateAffine(),n.updateAffine(),r.affine),r.position.copy(r.affine.vector),r.shear.x.rad=_(e.shear.x.rad+n.shear.x.rad),r.shear.y.rad=_(e.shear.y.rad+n.shear.y.rad);var i=Math.atan2(r.affine.matrix.c,r.affine.matrix.a);return r.rotation.rad=_(i-r.shear.x.rad),x.combine(r.rotation.updateMatrix(),r.shear.updateMatrix(),r.scale),x.extract(r.affine.matrix,r.scale,r.scale),r},t.extract=function(e,n,r){void 0===r&&(r=new t),e===r&&(e=t.copy(e,new t)),n===r&&(n=t.copy(n,new t)),w.extract(e.updateAffine(),n.updateAffine(),r.affine),r.position.copy(r.affine.vector),r.shear.x.rad=_(e.shear.x.rad-n.shear.x.rad),r.shear.y.rad=_(e.shear.y.rad-n.shear.y.rad);var i=Math.atan2(r.affine.matrix.c,r.affine.matrix.a);return r.rotation.rad=_(i-r.shear.x.rad),x.combine(r.rotation.updateMatrix(),r.shear.updateMatrix(),r.scale),x.extract(r.affine.matrix,r.scale,r.scale),r},t.transform=function(t,e,n){return void 0===n&&(n=new g),w.transform(t.updateAffine(),e,n)},t.untransform=function(t,e,n){return void 0===n&&(n=new g),w.untransform(t.updateAffine(),e,n)},t.tween=function(e,n,r,i){return void 0===i&&(i=new t),e.position.tween(n.position,r,i.position),e.rotation.tween(n.rotation,r,i.rotation),e.scale.tween(n.scale,r,i.scale),e.shear.tween(n.shear,r,i.shear),i},t.prototype.tween=function(e,n,r){return void 0===r&&(r=new t),t.tween(this,e,n,r)},t.prototype.selfTween=function(e,n){return t.tween(this,e,n,this)},t}();e.Space=T;var M=function(){function t(){this.color=new u,this.parent_key="",this.length=0,this.local_space=new T,this.world_space=new T,this.inherit_rotation=!0,this.inherit_scale=!0,this.transform="normal"}return t.prototype.copy=function(t){return this.color.copy(t.color),this.parent_key=t.parent_key,this.length=t.length,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.inherit_rotation=t.inherit_rotation,this.inherit_scale=t.inherit_scale,this.transform=t.transform,this},t.prototype.load=function(t){if(this.color.load(t.color,2560137471),this.parent_key=h(t,"parent",""),this.length=a(t,"length",0),this.local_space.load(t),this.inherit_rotation=o(t,"inheritRotation",!0),this.inherit_scale=o(t,"inheritScale",!0),this.transform=h(t,"transform","normal"),t.transform)switch(t.transform){case"normal":this.inherit_rotation=this.inherit_scale=!0;break;case"onlyTranslation":this.inherit_rotation=this.inherit_scale=!1;break;case"noRotationOrReflection":this.inherit_rotation=!1;break;case"noScale":case"noScaleOrReflection":this.inherit_scale=!1;break;default:throw new Error("TODO: Space.transform: "+t.transform)}return this},t.flatten=function(e,n){var r=e.local_space,i=e.world_space,o=n.get(e.parent_key);if(o){t.flatten(o,n);var a=o.world_space;if(T.transform(a,r.position,i.position),e.inherit_rotation&&e.inherit_scale)x.copy(a.affine.matrix,i.affine.matrix);else if(e.inherit_rotation)for(x.identity(i.affine.matrix);o&&o.inherit_rotation;){var s=o.local_space;x.rotate(i.affine.matrix,s.rotation.cos,s.rotation.sin,i.affine.matrix),o=n.get(o.parent_key)}else if(e.inherit_scale)for(x.identity(i.affine.matrix);o&&o.inherit_scale;){var c=(s=o.local_space).rotation.cos,h=s.rotation.sin;x.rotate(i.affine.matrix,c,h,i.affine.matrix),x.multiply(i.affine.matrix,s.scale,i.affine.matrix),s.scale.x>=0&&(h=-h),x.rotate(i.affine.matrix,c,h,i.affine.matrix),o=n.get(o.parent_key)}else x.identity(i.affine.matrix);r.updateAffine(),x.multiply(i.affine.matrix,r.affine.matrix,i.affine.matrix),i.shear.x.rad=_(a.shear.x.rad+r.shear.x.rad),i.shear.y.rad=_(a.shear.y.rad+r.shear.y.rad);var u=Math.atan2(i.affine.matrix.c,i.affine.matrix.a);i.rotation.rad=_(u-i.shear.x.rad),x.combine(i.rotation.updateMatrix(),i.shear.updateMatrix(),i.scale),x.extract(i.affine.matrix,i.scale,i.scale)}else i.copy(r),i.updateAffine();return e},t}();e.Bone=M;var P=function(){function t(){this.order=0}return t.prototype.load=function(t){return this.order=c(t,"order",0),this},t}();e.Constraint=P;var S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bone_keys=[],e.target_key="",e.mix=1,e.bend_positive=!0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.bone_keys=e.bones||[],this.target_key=h(e,"target",""),this.mix=a(e,"mix",1),this.bend_positive=o(e,"bendPositive",!0),this},e}(P);e.Ikc=S;var R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bone_keys=[],e.target_key="",e.position_mix=1,e.position=new b,e.rotation_mix=1,e.rotation=new k,e.scale_mix=1,e.scale=new E,e.shear_mix=1,e.shear=new A,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.bone_keys=e.bones||[],this.target_key=h(e,"target",""),this.position_mix=a(e,"translateMix",1),this.position.x=a(e,"x",0),this.position.y=a(e,"y",0),this.rotation_mix=a(e,"rotateMix",1),this.rotation.deg=a(e,"rotation",0),this.scale_mix=a(e,"scaleMix",1),this.scale.x=a(e,"scaleX",1),this.scale.y=a(e,"scaleY",1),this.shear_mix=a(e,"shearMix",1),this.shear.x.deg=a(e,"shearX",0),this.shear.y.deg=a(e,"shearY",0),this},e}(P);e.Xfc=R;var I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bone_keys=[],e.target_key="",e.spacing_mode="length",e.spacing=0,e.position_mode="percent",e.position_mix=1,e.position=0,e.rotation_mode="tangent",e.rotation_mix=1,e.rotation=new k,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.bone_keys=e.bones||[],this.target_key=h(e,"target",""),this.spacing_mode=h(e,"spacingMode","length"),this.spacing=a(e,"spacing",0),this.position_mode=h(e,"positionMode","percent"),this.position_mix=a(e,"translateMix",1),this.position=a(e,"position",0),this.rotation_mode=h(e,"rotateMode","tangent"),this.rotation_mix=a(e,"rotateMix",1),this.rotation.deg=a(e,"rotation",0),this},e}(P);e.Ptc=I;var D=function(){function t(){this.bone_key="",this.color=new u,this.attachment_key="",this.blend="normal"}return t.prototype.copy=function(t){return this.bone_key=t.bone_key,this.color.copy(t.color),this.attachment_key=t.attachment_key,this.blend=t.blend,this},t.prototype.load=function(t){return this.bone_key=h(t,"bone",""),this.color.load(t.color),this.attachment_key=h(t,"attachment",""),this.blend=h(t,"blend","normal"),this},t}();e.Slot=D;var O=function(){function t(t){this.type="",this.name="",this.type=t}return t.prototype.load=function(t){if(h(t,"type","region")!==this.type)throw new Error;return this.name=h(t,"name",""),this},t}();e.Attachment=O;var C=function(t){function e(){var e=t.call(this,"region")||this;return e.path="",e.color=new u,e.local_space=new T,e.width=0,e.height=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.path=h(e,"path",""),this.color.load(e.color),this.local_space.load(e),this.width=a(e,"width",0),this.height=a(e,"height",0),this},e}(O);e.RegionAttachment=C;var N=function(t){function e(){var e=t.call(this,"boundingbox")||this;return e.color=new u,e.vertex_count=0,e.vertices=[],e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color,1626341631),this.vertex_count=c(e,"vertexCount",0),this.vertices=e.vertices,this},e}(O);e.BoundingBoxAttachment=N;var F=function(t){function e(){var e=t.call(this,"mesh")||this;return e.path="",e.color=new u,e.triangles=[],e.edges=[],e.vertices=[],e.uvs=[],e.hull=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.path=h(e,"path",""),this.color.load(e.color),this.triangles=e.triangles||[],this.edges=e.edges||[],this.vertices=e.vertices||[],this.uvs=e.uvs||[],this.hull=c(e,"hull",0),this},e}(O);e.MeshAttachment=F;var B=function(t){function e(){var e=t.call(this,"linkedmesh")||this;return e.color=new u,e.skin_key="",e.parent_key="",e.inherit_deform=!0,e.width=0,e.height=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color),this.skin_key=h(e,"skin",""),this.parent_key=h(e,"parent",""),this.inherit_deform=o(e,"deform",!0),this.width=c(e,"width",0),this.height=c(e,"height",0),this},e}(O);e.LinkedMeshAttachment=B;var L=function(t){function e(){var e=t.call(this,"weightedmesh")||this;return e.path="",e.color=new u,e.triangles=[],e.edges=[],e.vertices=[],e.uvs=[],e.hull=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.path=h(e,"path",""),this.color.load(e.color),this.triangles=e.triangles||[],this.edges=e.edges||[],this.vertices=e.vertices||[],this.uvs=e.uvs||[],this.hull=c(e,"hull",0),this},e}(O);e.WeightedMeshAttachment=L;var U=function(t){function e(){var e=t.call(this,"path")||this;return e.color=new u,e.closed=!1,e.accurate=!0,e.lengths=[],e.vertex_count=0,e.vertices=[],e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color,4286513407),this.closed=o(e,"closed",!1),this.accurate=o(e,"constantSpeed",!0),this.lengths=e.lengths||[],this.vertex_count=c(e,"vertexCount",0),this.vertices=e.vertices||[],this},e}(O);e.PathAttachment=U;var j=function(){function t(){this.attachments=new i}return t.prototype.load=function(t){var e=this;return this.attachments.clear(),Object.keys(t||{}).forEach(function(n){switch(t[n].type){default:case"region":e.attachments.set(n,(new C).load(t[n]));break;case"boundingbox":e.attachments.set(n,(new N).load(t[n]));break;case"mesh":t[n].vertices.length===t[n].uvs.length?e.attachments.set(n,(new F).load(t[n])):(t[n].type="weightedmesh",e.attachments.set(n,(new L).load(t[n])));break;case"linkedmesh":e.attachments.set(n,(new B).load(t[n]));break;case"skinnedmesh":t[n].type="weightedmesh";case"weightedmesh":e.attachments.set(n,(new L).load(t[n]));break;case"path":e.attachments.set(n,(new U).load(t[n]))}}),this},t}();e.SkinSlot=j;var q=function(){function t(){this.name="",this.slots=new i}return t.prototype.load=function(t){var e=this;return this.name=h(t,"name",""),Object.keys(t||{}).forEach(function(n){e.slots.set(n,(new j).load(t[n]))}),this},t.prototype.iterateAttachments=function(t){this.forEachAttachment(function(e,n,r,i){t(i,r,e&&e.name||n,e)})},t.prototype.forEachAttachment=function(t){this.slots.forEach(function(e,n){e.attachments.forEach(function(r,i){t(r,r&&r.name||i,e,n)})})},t.prototype.mapAttachments=function(t){var e=[];return this.slots.forEach(function(n,r){n.attachments.forEach(function(i,o){e.push(t(i,i&&i.name||o,n,r))})}),e},t}();e.Skin=q;var K=function(){function t(){this.int_value=0,this.float_value=0,this.string_value=""}return t.prototype.copy=function(t){return this.int_value=t.int_value,this.float_value=t.float_value,this.string_value=t.string_value,this},t.prototype.load=function(t){return"number"==typeof t.int&&(this.int_value=c(t,"int",0)),"number"==typeof t.float&&(this.float_value=a(t,"float",0)),"string"==typeof t.string&&(this.string_value=h(t,"string","")),this},t}();e.Event=K;var X=function(){function t(){this.min=0,this.max=0}return Object.defineProperty(t.prototype,"length",{get:function(){return this.max-this.min},enumerable:!0,configurable:!0}),t.prototype.reset=function(){return this.min=0,this.max=0,this},t.prototype.wrap=function(t){return d(t,this.min,this.max)},t.prototype.expandPoint=function(t){return this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),t},t.prototype.expandRange=function(t){return this.min=Math.min(this.min,t.min),this.max=Math.max(this.max,t.max),t},t}();e.Range=X;var G=function(){function t(){this.time=0}return t.prototype.free=function(){this.time=0},t.prototype.load=function(t){return this.time=1e3*a(t,"time",0),this},t.prototype.save=function(t){return s(t,"time",this.time/1e3,0),this},t.find=function(t,e){if(!t)return-1;if(t.length<=0)return-1;if(e<t[0].time)return-1;var n=t.length-1;if(e>=t[n].time)return n;var r=0,i=n;if(0===i)return 0;for(var o=i>>1;;){if(t[o+1].time<=e?r=o+1:i=o,r===i)return r;o=r+i>>1}},t.compare=function(t,e){return t.time-e.time},t.interpolate=function(t,e,n){return t&&e&&t.time!==e.time?(n-t.time)/(e.time-t.time):0},t.evaluate=function(e,n,r){var i=t.find(e,n);if(-1!==i){var o=i+1,a=e[i],s=e[o]||a;r(a,s,t.interpolate(a,s,n),i,o)}},t}();e.Keyframe=G;var Y=function(){function t(){this.range=new X,this.keyframes=[]}return t.prototype.load=function(t,e){var n=this;return this.range.reset(),this.keyframes.length=0,t.forEach(function(t,r){n.range.expandPoint((n.keyframes[r]=(new e).load(t)).time)}),this.keyframes.sort(G.compare),this},t.evaluate=function(t,e,n){t&&G.evaluate(t.keyframes,e,n)},t}();e.Timeline=Y;var W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curve=new f,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.curve.load(e.curve),this},e.interpolate=function(t,e,n){return t&&t.curve.evaluate(G.interpolate(t,e,n))||0},e}(G);e.CurveKeyframe=W;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position=new b,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.position.x=a(e,"x",0),this.position.y=a(e,"y",0),this},e}(W);e.BonePositionKeyframe=z;var V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,z)},e}(Y);e.BonePositionTimeline=V;var $=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rotation=new k,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.rotation.deg=a(e,"angle",0),this},e}(W);e.BoneRotationKeyframe=$;var H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,$)},e}(Y);e.BoneRotationTimeline=H;var Z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scale=new E,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.scale.x=a(e,"x",1),this.scale.y=a(e,"y",1),this},e}(W);e.BoneScaleKeyframe=Z;var J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,Z)},e}(Y);e.BoneScaleTimeline=J;var Q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shear=new A,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.shear.x.deg=a(e,"x",0),this.shear.y.deg=a(e,"y",0),this},e}(W);e.BoneShearKeyframe=Q;var tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,Q)},e}(Y);e.BoneShearTimeline=tt;var et=function(){function t(){this.range=new X}return t.prototype.load=function(t){return this.range.reset(),delete this.position_timeline,delete this.rotation_timeline,delete this.scale_timeline,delete this.shear_timeline,t.translate&&this.range.expandRange((this.position_timeline=(new V).load(t.translate)).range),t.rotate&&this.range.expandRange((this.rotation_timeline=(new H).load(t.rotate)).range),t.scale&&this.range.expandRange((this.scale_timeline=(new J).load(t.scale)).range),t.shear&&this.range.expandRange((this.shear_timeline=(new tt).load(t.shear)).range),this},t}();e.BoneTimeline=et;var nt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new u,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color),this},e}(W);e.SlotColorKeyframe=nt;var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,nt)},e}(Y);e.SlotColorTimeline=rt;var it=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="",e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.name=h(e,"name",""),this},e}(G);e.SlotAttachmentKeyframe=it;var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,it)},e}(Y);e.SlotAttachmentTimeline=ot;var at=function(){function t(){this.range=new X}return t.prototype.load=function(t){return this.range.reset(),delete this.color_timeline,delete this.attachment_timeline,t.color&&this.range.expandRange((this.color_timeline=(new rt).load(t.color)).range),t.attachment&&this.range.expandRange((this.attachment_timeline=(new ot).load(t.attachment)).range),this},t}();e.SlotTimeline=at;var st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="",e.event=new K,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.name=h(e,"name",""),this.event.load(e),this},e}(G);e.EventKeyframe=st;var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,st)},e}(Y);e.EventTimeline=ct;var ht=function(){function t(){this.slot_key="",this.offset=0}return t.prototype.load=function(t){return this.slot_key=h(t,"slot",""),this.offset=c(t,"offset",0),this},t}();e.SlotOffset=ht;var ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.slot_offsets=[],e}return r(e,t),e.prototype.load=function(e){var n=this;return t.prototype.load.call(this,e),this.slot_offsets.length=0,e.offsets&&e.offsets.forEach(function(t){n.slot_offsets.push((new ht).load(t))}),this},e}(G);e.OrderKeyframe=ut;var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,ut)},e}(Y);e.OrderTimeline=lt;var ft=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mix=1,e.bend_positive=!0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.mix=a(e,"mix",1),this.bend_positive=o(e,"bendPositive",!0),this},e}(W);e.IkcKeyframe=ft;var pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,ft)},e}(Y);e.IkcTimeline=pt;var dt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position_mix=1,e.rotation_mix=1,e.scale_mix=1,e.shear_mix=1,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.position_mix=a(e,"translateMix",1),this.rotation_mix=a(e,"rotateMix",1),this.scale_mix=a(e,"scaleMix",1),this.shear_mix=a(e,"shearMix",1),this},e}(W);e.XfcKeyframe=dt;var mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,dt)},e}(Y);e.XfcTimeline=mt;var _t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position_mix=0,e.rotation_mix=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.position_mix=a(e,"translateMix",1),this.rotation_mix=a(e,"rotateMix",1),this},e}(W);e.PtcMixKeyframe=_t;var vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,_t)},e}(Y);e.PtcMixTimeline=vt;var yt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spacing=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.spacing=a(e,"spacing",0),this},e}(W);e.PtcSpacingKeyframe=yt;var gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,yt)},e}(Y);e.PtcSpacingTimeline=gt;var xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position=0,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.position=a(e,"position",0),this},e}(W);e.PtcPositionKeyframe=xt;var wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,xt)},e}(Y);e.PtcPositionTimeline=wt;var bt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rotation=new k,e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.rotation.deg=a(e,"rotation",0),this},e}(W);e.PtcRotationKeyframe=bt;var kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,bt)},e}(Y);e.PtcRotationTimeline=kt;var Et=function(){function t(){this.range=new X}return t.prototype.load=function(t){return this.range.reset(),delete this.ptc_mix_timeline,delete this.ptc_spacing_timeline,delete this.ptc_position_timeline,delete this.ptc_rotation_timeline,t.mix&&this.range.expandRange((this.ptc_mix_timeline=(new vt).load(t.mix)).range),t.spacing&&this.range.expandRange((this.ptc_spacing_timeline=(new gt).load(t.spacing)).range),t.position&&this.range.expandRange((this.ptc_position_timeline=(new wt).load(t.position)).range),t.rotation&&this.range.expandRange((this.ptc_rotation_timeline=(new kt).load(t.rotation)).range),this},t}();e.PtcTimeline=Et;var At=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offset=0,e.vertices=[],e}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.offset=c(e,"offset",0),this.vertices=e.vertices||[],this},e}(W);e.FfdKeyframe=At;var Tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e,At)},e}(Y);e.FfdTimeline=Tt;var Mt=function(){function t(){this.ffd_timeline=new Tt}return t.prototype.load=function(t){return this.ffd_timeline.load(t),this},t}();e.FfdAttachment=Mt;var Pt=function(){function t(){this.ffd_attachments=new i}return t.prototype.load=function(t){var e=this;return this.ffd_attachments.clear(),Object.keys(t||{}).forEach(function(n){e.ffd_attachments.set(n,(new Mt).load(t[n]))}),this},t.prototype.iterateAttachments=function(t){this.forEachAttachment(function(e,n){t(n,e)})},t.prototype.forEachAttachment=function(t){this.ffd_attachments.forEach(function(e,n){t(e,n)})},t}();e.FfdSlot=Pt;var St=function(){function t(){this.ffd_slots=new i}return t.prototype.load=function(t){var e=this;return this.ffd_slots.clear(),Object.keys(t||{}).forEach(function(n){e.ffd_slots.set(n,(new Pt).load(t[n]))}),this},t.prototype.iterateAttachments=function(t){this.forEachAttachment(function(e,n,r,i){t(i,r,n,e)})},t.prototype.forEachAttachment=function(t){this.ffd_slots.forEach(function(e,n){e.forEachAttachment(function(r,i){t(r,i,e,n)})})},t}();e.FfdSkin=St;var Rt=function(){function t(){this.range=new X,this.bone_timeline_map=new i,this.slot_timeline_map=new i,this.ikc_timeline_map=new i,this.xfc_timeline_map=new i,this.ptc_timeline_map=new i,this.ffd_skins=new i}return t.prototype.load=function(t){var e=this;return this.range.reset(),this.bone_timeline_map.clear(),this.slot_timeline_map.clear(),delete this.event_timeline,delete this.order_timeline,this.ikc_timeline_map.clear(),this.xfc_timeline_map.clear(),this.ptc_timeline_map.clear(),this.ffd_skins.clear(),t.bones&&Object.keys(t.bones).forEach(function(n){e.range.expandRange(e.bone_timeline_map.set(n,(new et).load(t.bones[n])).range)}),t.slots&&Object.keys(t.slots).forEach(function(n){e.range.expandRange(e.slot_timeline_map.set(n,(new at).load(t.slots[n])).range)}),t.events&&this.range.expandRange((this.event_timeline=(new ct).load(t.events)).range),t.draworder=t.draworder||t.drawOrder,t.draworder&&this.range.expandRange((this.order_timeline=(new lt).load(t.draworder)).range),t.ik&&Object.keys(t.ik).forEach(function(n){e.range.expandRange(e.ikc_timeline_map.set(n,(new pt).load(t.ik[n])).range)}),t.transform&&Object.keys(t.transform).forEach(function(n){e.range.expandRange(e.xfc_timeline_map.set(n,(new mt).load(t.transform[n])).range)}),t.paths&&Object.keys(t.paths).forEach(function(n){e.range.expandRange(e.ptc_timeline_map.set(n,(new Et).load(t.paths[n])).range)}),t.deform=t.deform||t.ffd,t.deform&&Object.keys(t.deform).forEach(function(n){e.ffd_skins.set(n,(new St).load(t.deform[n]))}),this},t}();e.Animation=Rt;var It=function(){function t(){this.hash="",this.spine="",this.width=0,this.height=0,this.images=""}return t.prototype.load=function(t){return this.hash=h(t,"hash",""),this.spine=h(t,"spine",""),this.width=c(t,"width",0),this.height=c(t,"height",0),this.images=h(t,"images",""),this},t}();e.Skeleton=It;var Dt=function(){function t(){this.name="",this.skeleton=new It,this.bones=new i,this.ikcs=new i,this.xfcs=new i,this.ptcs=new i,this.slots=new i,this.skins=new i,this.events=new i,this.anims=new i}return t.prototype.free=function(){this.bones.clear(),this.ikcs.clear(),this.xfcs.clear(),this.ptcs.clear(),this.slots.clear(),this.skins.clear(),this.events.clear(),this.anims.clear()},t.prototype.load=function(t){var e=this;return this.bones.clear(),this.ikcs.clear(),this.xfcs.clear(),this.ptcs.clear(),this.slots.clear(),this.skins.clear(),this.events.clear(),this.anims.clear(),t.skeleton&&this.skeleton.load(t.skeleton),t.bones&&t.bones.forEach(function(t){e.bones.set(t.name,(new M).load(t))}),t.ik&&t.ik.forEach(function(t){e.ikcs.set(t.name,(new S).load(t))}),this.ikcs.sortKeys(function(t,n){var r=e.ikcs.get(t),i=e.ikcs.get(n);return(r&&r.order||0)-(i&&i.order||0)}),t.transform&&t.transform.forEach(function(t){e.xfcs.set(t.name,(new R).load(t))}),this.xfcs.sortKeys(function(t,n){var r=e.xfcs.get(t),i=e.xfcs.get(n);return(r&&r.order||0)-(i&&i.order||0)}),t.path&&t.path.forEach(function(t){e.ptcs.set(t.name,(new I).load(t))}),this.ptcs.sortKeys(function(t,n){var r=e.ptcs.get(t),i=e.ptcs.get(n);return(r&&r.order||0)-(i&&i.order||0)}),t.slots&&t.slots.forEach(function(t){e.slots.set(t.name,(new D).load(t))}),t.skins&&Object.keys(t.skins).forEach(function(n){var r=e.skins.set(n,(new q).load(t.skins[n]));r.name=r.name||n}),t.events&&Object.keys(t.events).forEach(function(n){e.events.set(n,(new K).load(t.events[n]))}),t.animations&&Object.keys(t.animations).forEach(function(n){e.anims.set(n,(new Rt).load(t.animations[n]))}),this.iterateBones(function(t,n){M.flatten(n,e.bones)}),this},t.prototype.save=function(t){return void 0===t&&(t={}),t},t.prototype.loadSkeleton=function(t){return this.skeleton.load(t),this},t.prototype.loadEvent=function(t,e){return this.events.set(t,(new K).load(e)),this},t.prototype.loadAnimation=function(t,e){return this.anims.set(t,(new Rt).load(e)),this},t.prototype.getSkins=function(){return this.skins},t.prototype.getEvents=function(){return this.events},t.prototype.getAnims=function(){return this.anims},t.prototype.iterateBones=function(t){this.forEachBone(function(e,n){t(n,e)})},t.prototype.forEachBone=function(t){this.bones.forEach(t)},t.prototype.iterateAttachments=function(t,e){this.forEachAttachment(t,function(t,n,r,i,o){e(i,r,o,n,t)})},t.prototype.forEachAttachment=function(t,e){var n=this.skins.get(t),r=this.skins.get("default");this.slots.forEach(function(t,i){var o=n&&n.slots.get(i)||r&&r.slots.get(i),a=o&&o.attachments.get(t.attachment_key),s=a&&a.name||t.attachment_key;a&&"linkedmesh"===a.type&&(s=a.parent_key,a=o&&o.attachments.get(s)),a&&o&&e(a,s,t,i,o)})},t.prototype.iterateSkins=function(t){this.forEachSkin(function(e,n){t(n,e)})},t.prototype.forEachSkin=function(t){this.skins.forEach(t)},t.prototype.mapSkins=function(t){return this.skins.map(t)},t.prototype.iterateEvents=function(t){this.forEachEvent(function(e,n){t(n,e)})},t.prototype.forEachEvent=function(t){this.events.forEach(t)},t.prototype.mapEvents=function(t){return this.events.map(t)},t.prototype.iterateAnims=function(t){this.forEachAnim(function(e,n){t(n,e)})},t.prototype.forEachAnim=function(t){this.anims.forEach(t)},t.prototype.mapAnims=function(t){return this.anims.map(t)},t}();e.Data=Dt;var Ot=function(){function t(t){this.skin_key="",this.anim_key="",this.time=0,this.prev_time=0,this.elapsed_time=0,this.wrapped_min=!1,this.wrapped_max=!1,this.dirty=!0,this.bones=new i,this.slots=new i,this.events=new i,this.data=t}return t.prototype.free=function(){this.bones.clear(),this.slots.clear(),this.events.clear()},t.prototype.curSkel=function(){return this.data.skeleton},t.prototype.getSkins=function(){return this.data.skins},t.prototype.curSkin=function(){return this.data.skins.get(this.skin_key)},t.prototype.getSkin=function(){return this.skin_key},t.prototype.setSkin=function(t){return this.skin_key!==t&&(this.skin_key=t),this},t.prototype.getAnims=function(){return this.data.anims},t.prototype.curAnim=function(){return this.data.anims.get(this.anim_key)},t.prototype.curAnimLength=function(){var t=this.data.anims.get(this.anim_key);return t&&t.range.length||0},t.prototype.getAnim=function(){return this.anim_key},t.prototype.setAnim=function(t){if(this.anim_key!==t){this.anim_key=t;var e=this.data.anims.get(this.anim_key);e&&(this.time=e.range.wrap(this.time)),this.prev_time=this.time,this.elapsed_time=0,this.dirty=!0}return this},t.prototype.getTime=function(){return this.time},t.prototype.setTime=function(t){var e=this.data.anims.get(this.anim_key);return e&&(t=e.range.wrap(t)),this.time!==t&&(this.time=t,this.prev_time=this.time,this.elapsed_time=0,this.dirty=!0),this},t.prototype.update=function(t){this.elapsed_time+=t,this.dirty=!0},t.prototype.strike=function(){if(this.dirty){this.dirty=!1,this.prev_time=this.time,this.time+=this.elapsed_time;var t=this.data.anims.get(this.anim_key);this.wrapped_min=!1,this.wrapped_max=!1,t&&(this.wrapped_min=this.elapsed_time<0&&this.time<=t.range.min,this.wrapped_max=this.elapsed_time>0&&this.time>=t.range.max,this.time=t.range.wrap(this.time)),this._strikeBones(t),this._strikeIkcs(t),this._strikeXfcs(t),this._strikeSlots(t),this._strikePtcs(t),this._strikeEvents(t),this.elapsed_time=0}},t.prototype._strikeBones=function(t){var e=this;this.data.bones.forEach(function(n,r){var i=e.bones.get(r)||e.bones.set(r,new M);i.copy(n);var o=t&&t.bone_timeline_map.get(r);o&&(o.position_timeline&&Y.evaluate(o.position_timeline,e.time,function(t,e,n){var r=t.curve.evaluate(n);i.local_space.position.x+=m(t.position.x,e.position.x,r),i.local_space.position.y+=m(t.position.y,e.position.y,r)}),o.rotation_timeline&&Y.evaluate(o.rotation_timeline,e.time,function(t,e,n){var r=t.curve.evaluate(n);i.local_space.rotation.rad+=v(t.rotation.rad,e.rotation.rad,r)}),o.scale_timeline&&Y.evaluate(o.scale_timeline,e.time,function(t,e,n){var r=t.curve.evaluate(n);i.local_space.scale.a*=m(t.scale.a,e.scale.a,r),i.local_space.scale.d*=m(t.scale.d,e.scale.d,r)}),o.shear_timeline&&Y.evaluate(o.shear_timeline,e.time,function(t,e,n){var r=t.curve.evaluate(n);i.local_space.shear.x.rad+=v(t.shear.x.rad,e.shear.x.rad,r),i.local_space.shear.y.rad+=v(t.shear.y.rad,e.shear.y.rad,r)}))}),this.forEachBone(function(t,n){M.flatten(t,e.bones)})},t.prototype._strikeIkcs=function(t){var e=this;this.data.ikcs.forEach(function(n,r){var i=e.bones.get(n.target_key);if(i){M.flatten(i,e.bones);var o=n.mix,a=n.bend_positive,s=t&&t.ikc_timeline_map.get(r);s&&Y.evaluate(s,e.time,function(t,e,n){o=m(t.mix,e.mix,t.curve.evaluate(n)),a=t.bend_positive});var c=o,h=a?1:-1;if(0!==c)switch(n.bone_keys.length){case 1:var u=e.bones.get(n.bone_keys[0]);if(!u)return;M.flatten(u,e.bones);var l=Math.atan2(i.world_space.position.y-u.world_space.position.y,i.world_space.position.x-u.world_space.position.x),f=e.bones.get(u.parent_key);f&&(M.flatten(f,e.bones),x.determinant(f.world_space.scale)<0?l+=f.world_space.rotation.rad:l-=f.world_space.rotation.rad),u.local_space.rotation.rad=v(u.local_space.rotation.rad,l,c);break;case 2:var p=e.bones.get(n.bone_keys[0]);if(!p)return;M.flatten(p,e.bones);var d=e.bones.get(n.bone_keys[1]);if(!d)return;M.flatten(d,e.bones);var _=p.local_space.scale.x,y=p.local_space.scale.y,w=d.local_space.position.y,b=d.local_space.scale.x,k=0,E=0,A=1;_<0&&(_=-_,k=Math.PI,A=-1),y<0&&(y=-y,A=-A),b<0&&(b=-b,E=Math.PI);var P=g.copy(i.world_space.position,new g),S=g.copy(d.world_space.position,new g),R=e.bones.get(p.parent_key);R&&(M.flatten(R,e.bones),T.untransform(R.world_space,P,P),T.untransform(R.world_space,S,S)),g.subtract(P,p.local_space.position,P),g.subtract(S,p.local_space.position,S);var I=P.x,D=P.y,O=S.x,C=S.y,N=Math.sqrt(O*O+C*C),F=d.length*b,B=(l=void 0,void 0);t:if(Math.abs(_-y)<=1e-4){var L=(I*I+D*D-N*N-(F*=_)*F)/(2*N*F);L<-1?L=-1:L>1&&(L=1),B=Math.acos(L)*h;var U=N+F*L,j=F*Math.sin(B);l=Math.atan2(D*U-I*j,I*U+D*j)}else{w=0;var q=_*F,K=y*F,X=Math.atan2(D,I),G=q*q,W=K*K,z=I*I+D*D,V=W*(N*N)+G*z-G*W,$=-2*W*N,H=W-G,Z=$*$-4*H*V;if(Z>=0){var J=Math.sqrt(Z);$<0&&(J=-J);var Q=(J=-($+J)/2)/H,tt=V/J,et=Math.abs(Q)<Math.abs(tt)?Q:tt;if(et*et<=z){var nt=Math.sqrt(z-et*et)*h;l=X-Math.atan2(nt,et),B=Math.atan2(nt/y,(et-N)/_);break t}}var rt,it,ot=0,at=Number.MAX_VALUE,st=0,ct=0,ht=0,ut=0,lt=0,ft=0,pt=void 0,dt=void 0;(pt=(dt=N+q)*dt)>ut&&(ht=0,ut=pt,lt=dt),(pt=(dt=N-q)*dt)<at&&(ot=Math.PI,at=pt,st=dt),rt=Math.acos(-q*N/(G-W)),(pt=(dt=q*Math.cos(rt)+N)*dt+(it=K*Math.sin(rt))*it)<at&&(ot=rt,at=pt,st=dt,ct=it),pt>ut&&(ht=rt,ut=pt,lt=dt,ft=it),z<=(at+ut)/2?(l=X-Math.atan2(ct*h,st),B=ot*h):(l=X-Math.atan2(ft*h,lt),B=ht*h)}var mt=Math.atan2(w,d.local_space.position.x)*A;l=l-mt+k,B=(B+mt)*A+E,p.local_space.rotation.rad=v(p.local_space.rotation.rad,l,c),d.local_space.rotation.rad=v(d.local_space.rotation.rad,B,c)}}}),this.forEachBone(function(t,n){M.flatten(t,e.bones)})},t.prototype._strikeXfcs=function(t){var e=this;this.data.xfcs.forEach(function(n,r){var i=e.bones.get(n.target_key);if(i){var o=n.position_mix,a=n.rotation_mix,s=n.scale_mix,c=n.shear_mix,h=t&&t.xfc_timeline_map.get(r);h&&Y.evaluate(h,e.time,function(t,e,n){var r=t.curve.evaluate(n);o=m(t.position_mix,e.position_mix,r),a=m(t.rotation_mix,e.rotation_mix,r),s=m(t.scale_mix,e.scale_mix,r),c=m(t.shear_mix,e.shear_mix,r)});var u=n.position,l=n.rotation,f=n.scale,p=n.shear,d=i.world_space.affine.matrix.a,v=i.world_space.affine.matrix.b,y=i.world_space.affine.matrix.c,x=i.world_space.affine.matrix.d;n.bone_keys.forEach(function(t){var n=e.bones.get(t);if(n){if(0!==o){var r=T.transform(i.world_space,u,new g);n.world_space.position.tween(r,o,n.world_space.position)}if(0!==a){var h=n.world_space.affine.matrix.a,m=n.world_space.affine.matrix.c;A=_(A=Math.atan2(y,d)-Math.atan2(m,h)+l.rad),A*=a;var w=Math.cos(A),b=Math.sin(A);n.world_space.affine.matrix.selfRotate(w,b)}if(0!==s){var k=Math.sqrt(n.world_space.affine.matrix.a*n.world_space.affine.matrix.a+n.world_space.affine.matrix.c*n.world_space.affine.matrix.c),E=Math.sqrt(d*d+y*y);k>1e-5&&(k=(k+(E-k+f.x)*s)/k),n.world_space.affine.matrix.a*=k,n.world_space.affine.matrix.c*=k,k=Math.sqrt(n.world_space.affine.matrix.b*n.world_space.affine.matrix.b+n.world_space.affine.matrix.d*n.world_space.affine.matrix.d),E=Math.sqrt(v*v+x*x),k>1e-5&&(k=(k+(E-k+f.y)*s)/k),n.world_space.affine.matrix.b*=k,n.world_space.affine.matrix.d*=k}if(0!==c){var A,M=n.world_space.affine.matrix.b,P=n.world_space.affine.matrix.d,S=Math.atan2(P,M);A=S+((A=_(A=Math.atan2(x,v)-Math.atan2(y,d)-(S-Math.atan2(n.world_space.affine.matrix.c,n.world_space.affine.matrix.a))))+p.y.rad)*c;k=Math.sqrt(M*M+P*P);n.world_space.affine.matrix.b=Math.cos(A)*k,n.world_space.affine.matrix.d=Math.sin(A)*k}}})}})},t.prototype._strikeSlots=function(t){var e=this;this.data.slots.forEach(function(n,r){var i=e.slots.get(r)||e.slots.set(r,new D);i.copy(n);var o=t&&t.slot_timeline_map.get(r);o&&(o.color_timeline&&Y.evaluate(o.color_timeline,e.time,function(t,e,n){t.color.tween(e.color,t.curve.evaluate(n),i.color)}),o.attachment_timeline&&Y.evaluate(o.attachment_timeline,e.time,function(t,e,n){i.attachment_key=t.name}))}),this.data.slots._keys.forEach(function(t,n){e.slots._keys[n]=t});var n=t&&t.order_timeline;n&&Y.evaluate(n,this.time,function(t,n,r){t.slot_offsets.forEach(function(t){var n=e.slots._keys.indexOf(t.slot_key);-1!==n&&(e.slots._keys.splice(n,1),e.slots._keys.splice(n+t.offset,0,t.slot_key))})})},t.prototype._strikePtcs=function(t){var e=this,n=this.data.skins.get(this.skin_key),r=this.data.skins.get("default");this.data.ptcs.forEach(function(i,o){var a=i.target_key,s=e.slots.get(a),c=n&&n.slots.get(a)||r&&r.slots.get(a);if((s&&c&&c.attachments.get(s.attachment_key))instanceof U){i.spacing_mode,i.spacing,i.position_mode,i.position_mix,i.position,i.rotation_mode,i.rotation_mix;var h=i.rotation,u=t&&t.ptc_timeline_map.get(o);u&&(u.ptc_mix_timeline&&Y.evaluate(u.ptc_mix_timeline,e.time,function(t,e,n){var r=t.curve.evaluate(n);m(t.position_mix,e.position_mix,r),m(t.rotation_mix,e.rotation_mix,r)}),u.ptc_spacing_timeline&&Y.evaluate(u.ptc_spacing_timeline,e.time,function(t,e,n){m(t.spacing,e.spacing,t.curve.evaluate(n))}),u.ptc_position_timeline&&Y.evaluate(u.ptc_position_timeline,e.time,function(t,e,n){m(t.position,e.position,t.curve.evaluate(n))}),u.ptc_rotation_timeline&&Y.evaluate(u.ptc_rotation_timeline,e.time,function(t,e,n){h.rad=v(t.rotation.rad,e.rotation.rad,t.curve.evaluate(n))})),i.bone_keys.forEach(function(t){e.bones.get(t)})}})},t.prototype._strikeEvents=function(t){var e=this;if(this.events.clear(),t&&t.event_timeline){var n=function(t){var n=new K,r=e.data.events.get(t.name);return r&&n.copy(r),n.int_value=t.event.int_value||n.int_value,n.float_value=t.event.float_value||n.float_value,n.string_value=t.event.string_value||n.string_value,n};this.elapsed_time<0?this.wrapped_min?t.event_timeline.keyframes.forEach(function(r){(t.range.min<=r.time&&r.time<e.prev_time||e.time<=r.time&&r.time<=t.range.max)&&e.events.set(r.name,n(r))}):t.event_timeline.keyframes.forEach(function(t){e.time<=t.time&&t.time<e.prev_time&&e.events.set(t.name,n(t))}):this.wrapped_max?t.event_timeline.keyframes.forEach(function(r){(t.range.min<=r.time&&r.time<=e.time||e.prev_time<r.time&&r.time<=t.range.max)&&e.events.set(r.name,n(r))}):t.event_timeline.keyframes.forEach(function(t){e.prev_time<t.time&&t.time<=e.time&&e.events.set(t.name,n(t))})}},t.prototype.iterateBones=function(t){this.forEachBone(function(e,n){t(n,e)})},t.prototype.forEachBone=function(t){this.bones.forEach(t)},t.prototype.iterateAttachments=function(t){this.forEachAttachment(function(e,n,r,i,o){t(i,r,o,n,e)})},t.prototype.forEachAttachment=function(t){var e=this.data.skins.get(this.skin_key),n=this.data.skins.get("default");this.slots.forEach(function(r,i){var o=e&&e.slots.get(i)||n&&n.slots.get(i),a=o&&o.attachments.get(r.attachment_key),s=a&&a.name||r.attachment_key;a&&"linkedmesh"===a.type&&(s=a.parent_key,a=o&&o.attachments.get(s)),a&&o&&t(a,s,r,i,o)})},t.prototype.iterateEvents=function(t){this.forEachEvent(function(e,n){t(n,e)})},t.prototype.forEachEvent=function(t){this.events.forEach(t)},t}();e.Pose=Ot},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(t){this.bone_map=new r.Map,this.skin_map=new r.Map,this.textures=new r.Map,this.projection=P(new Float32Array(16)),this.modelview=P(new Float32Array(16)),this.texmatrix=w(new Float32Array(9)),this.color=g(new Float32Array(4)),this.skin_shader_modelview_count=16,this.skin_shader_modelview_array=new Float32Array(16*this.skin_shader_modelview_count),this.skin_shader_blenders_count=8,this.gl=t;var e=["uniform sampler2D uSampler;","uniform vec4 uColor;","varying vec3 vTexCoord;","void main(void) {"," gl_FragColor = uColor * texture2D(uSampler, vTexCoord.st);","}"];this.mesh_shader=j(t,["uniform mat4 uProjection;","uniform mat4 uModelview;","uniform mat3 uTexMatrix;","attribute vec2 aPosition;","attribute vec2 aTexCoord;","varying vec3 vTexCoord;","void main(void) {"," gl_Position = uProjection * uModelview * vec4(aPosition, 0.0, 1.0);"," vTexCoord = uTexMatrix * vec3(aTexCoord, 1.0);","}"],e),this.ffd_mesh_shader=j(t,["uniform mat4 uProjection;","uniform mat4 uModelview;","uniform mat3 uTexMatrix;","uniform float uMorphWeight;","attribute vec2 aPosition;","attribute vec2 aTexCoord;","attribute vec2 aPositionMorph0;","attribute vec2 aPositionMorph1;","varying vec3 vTexCoord;","void main(void) {"," gl_Position = uProjection * uModelview * vec4(aPosition + mix(aPositionMorph0, aPositionMorph1, uMorphWeight), 0.0, 1.0);"," vTexCoord = uTexMatrix * vec3(aTexCoord, 1.0);","}"],e);var n=["uniform mat4 uProjection;","uniform mat4 uModelviewArray["+this.skin_shader_modelview_count+"];","uniform mat3 uTexMatrix;","attribute vec2 aPosition;","attribute vec2 aTexCoord;",d("attribute vec2 aBlenders{index};",this.skin_shader_blenders_count),"varying vec3 vTexCoord;","void main(void) {"," vec4 position = vec4(aPosition, 0.0, 1.0);"," vec4 blendPosition = vec4(0.0);",d(" blendPosition += (uModelviewArray[int(aBlenders{index}.x)] * position) * aBlenders{index}.y;",this.skin_shader_blenders_count)," gl_Position = uProjection * vec4(blendPosition.xy, 0.0, 1.0);"," vTexCoord = uTexMatrix * vec3(aTexCoord, 1.0);","}"],i=["uniform mat4 uProjection;","uniform mat4 uModelviewArray["+this.skin_shader_modelview_count+"];","uniform mat3 uTexMatrix;","uniform float uMorphWeight;","attribute vec2 aPosition;","attribute vec2 aTexCoord;","attribute vec2 aPositionMorph0;","attribute vec2 aPositionMorph1;",d("attribute vec2 aBlenders{index};",this.skin_shader_blenders_count),"varying vec3 vTexCoord;","void main(void) {"," vec4 position = vec4(aPosition + mix(aPositionMorph0, aPositionMorph1, uMorphWeight), 0.0, 1.0);"," vec4 blendPosition = vec4(0.0);",d(" blendPosition += (uModelviewArray[int(aBlenders{index}.x)] * position) * aBlenders{index}.y;",this.skin_shader_blenders_count)," gl_Position = uProjection * vec4(blendPosition.xy, 0.0, 1.0);"," vTexCoord = uTexMatrix * vec3(aTexCoord, 1.0);","}"],o=["uniform sampler2D uSampler;","uniform vec4 uColor;","varying vec3 vTexCoord;","void main(void) {"," gl_FragColor = uColor * texture2D(uSampler, vTexCoord.st);","}"];this.skin_shader=j(t,n,o),this.ffd_skin_shader=j(t,i,o),this.region_vertex_position=q(t,new Float32Array([-1,-1,1,-1,1,1,-1,1]),2,t.ARRAY_BUFFER,t.STATIC_DRAW),this.region_vertex_texcoord=q(t,new Float32Array([0,1,1,1,1,0,0,0]),2,t.ARRAY_BUFFER,t.STATIC_DRAW)}return t.prototype.loadData=function(t,e,n){var i=this;if(t.iterateBones(function(t,e){var n=i.bone_map.get(t)||i.bone_map.set(t,new o);r.Space.invert(e.world_space,n.setup_space)}),t.iterateSkins(function(e,n){var r=i.skin_map.get(e)||i.skin_map.set(e,new a);n.iterateAttachments(function(n,o,a,l){if(l){var f=r.slot_map.get(n)||r.slot_map.set(n,new s);switch(l.type){case"region":f.attachment_map.set(a,new c(i).loadData(t,e,n,a,l));break;case"mesh":f.attachment_map.set(a,new h(i).loadData(t,e,n,a,l));break;case"weightedmesh":f.attachment_map.set(a,new u(i).loadData(t,e,n,a,l))}}})}),e){var l=this.gl;e.pages.forEach(function(t){if("RGBA8888"!==t.format)throw new Error(t.format);var e=l.NONE;switch(t.min_filter){case"Nearest":e=l.NEAREST;break;default:case"Linear":e=l.LINEAR;break;case"MipMapNearestNearest":e=l.NEAREST_MIPMAP_NEAREST;break;case"MipMapLinearNearest":e=l.LINEAR_MIPMAP_NEAREST;break;case"MipMapNearestLinear":e=l.NEAREST_MIPMAP_LINEAR;break;case"MipMapLinearLinear":e=l.LINEAR_MIPMAP_LINEAR}var r=l.NONE;switch(t.mag_filter){case"Nearest":r=l.NEAREST;break;default:case"Linear":r=l.LINEAR}var o=l.NONE;switch(t.wrap_s){case"Repeat":o=l.REPEAT;break;default:case"ClampToEdge":o=l.CLAMP_TO_EDGE;break;case"MirroredRepeat":o=l.MIRRORED_REPEAT}var a=l.NONE;switch(t.wrap_t){case"Repeat":a=l.REPEAT;break;default:case"ClampToEdge":a=l.CLAMP_TO_EDGE;break;case"MirroredRepeat":a=l.MIRRORED_REPEAT}var s=t.name;i.textures.set(s,X(l,n.get(s),e,r,o,a))})}else{var f=this.gl;t.iterateSkins(function(t,e){e.iterateAttachments(function(t,e,r,o){if(o)switch(o.type){case"region":case"mesh":case"weightedmesh":var a=r;i.textures.set(a,X(f,n.get(a),f.LINEAR,f.LINEAR,f.CLAMP_TO_EDGE,f.CLAMP_TO_EDGE))}})})}},t.prototype.dropData=function(t,e){var n=this;void 0===e&&(e=null);var r=this.gl;this.textures.forEach(function(t,e){G(r,t)}),this.textures.clear(),this.bone_map.clear(),t.iterateSkins(function(e,r){var i=n.skin_map.get(e);r.iterateAttachments(function(n,r,o,a){if(a){var s=i&&i.slot_map.get(n),c=s&&s.attachment_map.get(o);c&&c.dropData(t,e,n,o,a)}})}),this.skin_map.clear()},t.prototype.drawPose=function(t,e){var n=this;void 0===e&&(e=null);var r=this.gl,i=this.color[3];t.iterateAttachments(function(o,a,s,c,h){if(h&&"boundingbox"!==h.type){switch(P(n.modelview),w(n.texmatrix),x(n.color,a.color),n.color[3]*=i,r.enable(r.BLEND),a.blend){default:case"normal":r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case"additive":r.blendFunc(r.SRC_ALPHA,r.ONE);break;case"multiply":r.blendFunc(r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA);break;case"screen":r.blendFunc(r.ONE,r.ONE_MINUS_SRC_COLOR)}var u=n.skin_map.get(t.skin_key),l=n.skin_map.get("default"),f=u&&u.slot_map.get(o)||l&&l.slot_map.get(o),p=f&&f.attachment_map.get(c);p&&p.drawPose(t,e,t.skin_key,o,a,c,h)}}),this.color[3]=i},t}();e.RenderWebGL=i;var o=function(){return function(){this.setup_space=new r.Space}}(),a=function(){return function(){this.slot_map=new r.Map}}(),s=function(){return function(){this.attachment_map=new r.Map}}(),c=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e,n,r,i){return this},t.prototype.dropData=function(t,e,n,r,i){return this},t.prototype.drawPose=function(t,e,n,r,i,o,a){var s=this.render.gl,c=t.bones.get(i.bone_key),h=e&&e.sites[a.path||a.name||o],u=h&&h.page,l=u&&u.name||a.path||a.name||o,f=this.render.textures.get(l);if(f){T(this.render.texmatrix,u),M(this.render.texmatrix,h),c&&C(this.render.modelview,c.world_space),C(this.render.modelview,a.local_space),O(this.render.modelview,a.width/2,a.height/2),N(this.render.modelview,h);var p=this.render.mesh_shader;s.useProgram(p.program),s.uniformMatrix4fv(p.uniforms.get("uProjection")||0,!1,this.render.projection),s.uniformMatrix4fv(p.uniforms.get("uModelview")||0,!1,this.render.modelview),s.uniformMatrix3fv(p.uniforms.get("uTexMatrix")||0,!1,this.render.texmatrix),s.uniform4fv(p.uniforms.get("uColor")||0,this.render.color),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,f.texture),s.uniform1i(p.uniforms.get("uSampler")||0,0),Y(s,p,"aPosition",this.render.region_vertex_position),Y(s,p,"aTexCoord",this.render.region_vertex_texcoord),s.drawArrays(s.TRIANGLE_FAN,0,this.render.region_vertex_position.count),W(s,p)}},t}(),h=function(){function t(t){this.ffd_attachment_map=new r.Map,this.render=t}return t.prototype.loadData=function(t,e,n,r,i){var o=this,a=this.render.gl,s=i.vertices.length/2,c=new Float32Array(i.vertices),h=new Float32Array(i.uvs),u=new Uint16Array(i.triangles);return this.vertex_position=q(a,c,2,a.ARRAY_BUFFER,a.STATIC_DRAW),this.vertex_texcoord=q(a,h,2,a.ARRAY_BUFFER,a.STATIC_DRAW),this.vertex_triangle=q(a,u,1,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW),t.iterateAnims(function(t,i){var c=i.ffd_skins&&i.ffd_skins.get(e),h=c&&c.ffd_slots.get(n),u=h&&h.ffd_attachments.get(r);if(u){var l=o.ffd_attachment_map.set(t,new f);u.ffd_timeline.keyframes.forEach(function(t,e){var n=l.ffd_keyframes[e]=new p,r=new Float32Array(2*s);r.subarray(t.offset,t.offset+t.vertices.length).set(new Float32Array(t.vertices)),n.vertex_position_morph=q(a,r,2,a.ARRAY_BUFFER,a.STATIC_DRAW)})}}),this},t.prototype.dropData=function(t,e,n,r,i){var o=this.render.gl;return K(o,this.vertex_position),K(o,this.vertex_texcoord),K(o,this.vertex_triangle),this.ffd_attachment_map.forEach(function(t,e){t.ffd_keyframes.forEach(function(t){K(o,t.vertex_position_morph)})}),this},t.prototype.drawPose=function(t,e,n,i,o,a,s){var c=this.render.gl,h=t.bones.get(o.bone_key),u=e&&e.sites[s.path||s.name||a],l=u&&u.page,f=l&&l.name||s.path||s.name||a,p=this.render.textures.get(f);if(p){T(this.render.texmatrix,l),M(this.render.texmatrix,u),h&&C(this.render.modelview,h.world_space),N(this.render.modelview,u);var d=t.data.anims.get(t.anim_key),m=d&&d.ffd_skins&&d.ffd_skins.get(t.skin_key),_=m&&m.ffd_slots.get(i),v=_&&_.ffd_attachments.get(a),y=v&&v.ffd_timeline,g=y&&y.keyframes,x=r.Keyframe.find(g,t.time),w=x+1||x,b=g&&g[x],k=g&&g[w]||b,E=r.FfdKeyframe.interpolate(b,k,t.time),A=this.ffd_attachment_map.get(t.anim_key),P=A&&A.ffd_keyframes[x],S=A&&A.ffd_keyframes[w]||P,R=b?this.render.ffd_mesh_shader:this.render.mesh_shader;c.useProgram(R.program),c.uniformMatrix4fv(R.uniforms.get("uProjection")||0,!1,this.render.projection),c.uniformMatrix4fv(R.uniforms.get("uModelview")||0,!1,this.render.modelview),c.uniformMatrix3fv(R.uniforms.get("uTexMatrix")||0,!1,this.render.texmatrix),c.uniform4fv(R.uniforms.get("uColor")||0,this.render.color),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,p.texture),c.uniform1i(R.uniforms.get("uSampler")||0,0),Y(c,R,"aPosition",this.vertex_position),Y(c,R,"aTexCoord",this.vertex_texcoord),b&&c.uniform1f(R.uniforms.get("uMorphWeight")||0,E),P&&Y(c,R,"aPositionMorph0",P.vertex_position_morph),S&&Y(c,R,"aPositionMorph1",S.vertex_position_morph);var I=this.vertex_triangle;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,I.buffer),c.drawElements(c.TRIANGLES,I.count,I.type,0),W(c,R)}},t}(),u=function(){function t(t){this.blend_bone_index_array=[],this.ffd_attachment_map=new r.Map,this.render=t}return t.prototype.loadData=function(t,e,n,i,o){var a=this;function s(t,e,n){for(var r=t[e++],i=0;i<r;++i){var o=new l;o.bone_index=t[e++],o.position.x=t[e++],o.position.y=t[e++],o.weight=t[e++],n(o,i)}return e}for(var c,h=this.render.gl,u=o.uvs.length/2,d=new Float32Array(2*u),m=new Float32Array(o.uvs),_=new Float32Array(2*u*this.render.skin_shader_blenders_count),v=new Uint16Array(o.triangles),y=this.blend_bone_index_array,g=function(e,n){var h=[];n=s(o.vertices,n,function(t){h.push(t)}),h.sort(function(t,e){return e.weight-t.weight}),h.length>x.render.skin_shader_blenders_count&&(console.log("blend array length for",i,"is",h.length,"so clamp to",x.render.skin_shader_blenders_count),h.length=x.render.skin_shader_blenders_count);var u=0;h.forEach(function(t){u+=t.weight}),h.forEach(function(t){t.weight/=u});var l=new r.Vector;h.forEach(function(n,i){var o=t.bones.getByIndex(n.bone_index),s=new r.Vector;o&&r.Space.transform(o.world_space,n.position,s),l.selfAdd(s.selfScale(n.weight)),-1===y.indexOf(n.bone_index)&&y.push(n.bone_index),_[2*e*a.render.skin_shader_blenders_count+2*i+0]=y.indexOf(n.bone_index),_[2*e*a.render.skin_shader_blenders_count+2*i+1]=n.weight}),d[2*e+0]=l.x,d[2*e+1]=l.y,y.length>x.render.skin_shader_modelview_count&&console.log("blend bone index array length for",i,"is",y.length,"greater than",x.render.skin_shader_modelview_count),c=n},x=this,w=0,b=0;w<u;++w)g(w,b),b=c;return this.vertex_position=q(h,d,2,h.ARRAY_BUFFER,h.STATIC_DRAW),this.vertex_texcoord=q(h,m,2,h.ARRAY_BUFFER,h.STATIC_DRAW),this.vertex_blenders=q(h,_,2,h.ARRAY_BUFFER,h.STATIC_DRAW),this.vertex_triangle=q(h,v,1,h.ELEMENT_ARRAY_BUFFER,h.STATIC_DRAW),t.iterateAnims(function(c,l){var d=l.ffd_skins&&l.ffd_skins.get(e),m=d&&d.ffd_slots.get(n),_=m&&m.ffd_attachments.get(i);if(_){var v=a.ffd_attachment_map.set(c,new f);_.ffd_timeline.keyframes.forEach(function(e,n){for(var i,a,c=v.ffd_keyframes[n]=new p,l=new Float32Array(2*u),f=function(n,c,h){var u=[];c=s(o.vertices,c,function(t){u.push(t)});var f=new r.Vector;u.forEach(function(n){var i=t.bones.getByIndex(n.bone_index),o=new r.Vector;o.x=e.vertices[h-e.offset]||0,++h,o.y=e.vertices[h-e.offset]||0,++h,i&&r.Matrix.transform(i.world_space.affine.matrix,o,o),f.selfAdd(o.selfScale(n.weight))}),l[2*n+0]=f.x,l[2*n+1]=f.y,i=c,a=h},d=0,m=0,_=0;d<u;++d)f(d,m,_),m=i,_=a;c.vertex_position_morph=q(h,l,2,h.ARRAY_BUFFER,h.STATIC_DRAW)})}}),this},t.prototype.dropData=function(t,e,n,r,i){var o=this.render.gl;return K(o,this.vertex_position),K(o,this.vertex_blenders),K(o,this.vertex_texcoord),K(o,this.vertex_triangle),this.ffd_attachment_map.forEach(function(t,e){t.ffd_keyframes.forEach(function(t){K(o,t.vertex_position_morph)})}),this},t.prototype.drawPose=function(t,e,n,i,o,a,s){var c=this.render.gl,h=e&&e.sites[s.path||s.name||a],u=h&&h.page,l=u&&u.name||s.path||s.name||a,f=this.render.textures.get(l);if(f){T(this.render.texmatrix,u),M(this.render.texmatrix,h);for(var p=this.blend_bone_index_array,d=0;d<p.length;++d)if(d<this.render.skin_shader_modelview_count){var m=p[d],_=t.bones.key(m),v=t.bones.get(_),y=this.render.bone_map.get(_),g=this.render.skin_shader_modelview_array.subarray(16*d,16*(d+1));S(g,this.render.modelview),v&&C(g,v.world_space),y&&C(g,y.setup_space),N(g,h)}var x=t.data.anims.get(t.anim_key),w=x&&x.ffd_skins&&x.ffd_skins.get(t.skin_key),b=w&&w.ffd_slots.get(i),k=b&&b.ffd_attachments.get(a),E=k&&k.ffd_timeline,A=E&&E.keyframes,P=r.Keyframe.find(A,t.time),R=P+1||P,I=A&&A[P],D=A&&A[R]||I,O=r.FfdKeyframe.interpolate(I,D,t.time),F=this.ffd_attachment_map.get(t.anim_key),B=F&&F.ffd_keyframes[P],L=F&&F.ffd_keyframes[R]||B,U=I?this.render.ffd_skin_shader:this.render.skin_shader;c.useProgram(U.program),c.uniformMatrix4fv(U.uniforms.get("uProjection")||0,!1,this.render.projection),c.uniformMatrix4fv(U.uniforms.get("uModelviewArray[0]")||0,!1,this.render.skin_shader_modelview_array),c.uniformMatrix3fv(U.uniforms.get("uTexMatrix")||0,!1,this.render.texmatrix),c.uniform4fv(U.uniforms.get("uColor")||0,this.render.color),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,f.texture),c.uniform1i(U.uniforms.get("uSampler")||0,0),Y(c,U,"aPosition",this.vertex_position),Y(c,U,"aTexCoord",this.vertex_texcoord),Y(c,U,"aBlenders{index}",this.vertex_blenders,this.render.skin_shader_blenders_count),I&&c.uniform1f(U.uniforms.get("uMorphWeight")||0,O),B&&Y(c,U,"aPositionMorph0",B.vertex_position_morph),L&&Y(c,U,"aPositionMorph1",L.vertex_position_morph);var j=this.vertex_triangle;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,j.buffer),c.drawElements(c.TRIANGLES,j.count,j.type,0),W(c,U)}},t}(),l=function(){return function(){this.position=new r.Vector,this.bone_index=-1,this.weight=0}}(),f=function(){return function(){this.ffd_keyframes=[]}}(),p=function(){return function(){}}();function d(t,e){for(var n=[],r=0;r<e;++r)n.push(t.replace(/{index}/g,r.toString()));return n}function m(t,e){return void 0===e&&(e=[]),t.forEach(function(t){Array.isArray(t)?m(t,e):e.push(t)}),e}var _=function(){return function(){this.vs_src=[],this.fs_src=[],this.vs=null,this.fs=null,this.program=null,this.uniforms=new Map,this.attribs=new Map}}(),v=function(){return function(){this.buffer=null}}(),y=function(){return function(){this.texture=null}}();function g(t){return t[0]=t[1]=t[2]=t[3]=1,t}function x(t,e){return t[0]=e.r,t[1]=e.g,t[2]=e.b,t[3]=e.a,t}function w(t){return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,t}function b(t,e,n){return t[6]+=t[0]*e+t[3]*n,t[7]+=t[1]*e+t[4]*n,t}function k(t,e,n){var r=t[0],i=t[1],o=t[3],a=t[4];return t[0]=r*e+o*n,t[1]=i*e+a*n,t[3]=o*e-r*n,t[4]=a*e-i*n,t}function E(t,e){return k(t,Math.cos(e),Math.sin(e))}function A(t,e,n){return t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=n,t[4]*=n,t[5]*=n,t}function T(t,e){return e&&A(t,1/e.w,1/e.h),t}function M(t,e){return e&&(b(t,e.x,e.y),-1===e.rotate?(b(t,0,e.w),k(t,0,-1)):1===e.rotate&&(b(t,e.h,0),k(t,0,1)),A(t,e.w,e.h)),t}function P(t){return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,t}function S(t,e){return t.set(e),t}function R(t,e,n,r){return void 0===r&&(r=0),t[12]+=t[0]*e+t[4]*n+t[8]*r,t[13]+=t[1]*e+t[5]*n+t[9]*r,t[14]+=t[2]*e+t[6]*n+t[10]*r,t[15]+=t[3]*e+t[7]*n+t[11]*r,t}function I(t,e,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],h=t[6],u=t[7];return t[0]=r*e+s*n,t[1]=i*e+c*n,t[2]=o*e+h*n,t[3]=a*e+u*n,t[4]=s*e-r*n,t[5]=c*e-i*n,t[6]=h*e-o*n,t[7]=u*e-a*n,t}function D(t,e){return I(t,Math.cos(e),Math.sin(e))}function O(t,e,n,r){return void 0===r&&(r=1),t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=r,t[9]*=r,t[10]*=r,t[11]*=r,t}function C(t,e){return e&&(R(t,e.position.x,e.position.y),D(t,e.rotation.rad),O(t,e.scale.x,e.scale.y)),t}function N(t,e){return e&&(O(t,1/e.original_w,1/e.original_h),R(t,2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y),O(t,e.w,e.h)),t}function F(t,e,n){var r=t.createShader(n);return null===r?null:(t.shaderSource(r,e.join("\n")),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||(e.forEach(function(t,e){console.log(e+1,t)}),console.log(t.getShaderInfoLog(r)),t.deleteShader(r),r=null),r)}function B(t,e,n){if(null===e||null===n)return null;var r=t.createProgram();return null===r?null:(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||(console.log("could not link shader program"),t.detachShader(r,e),t.detachShader(r,n),t.deleteProgram(r),r=null),r)}function L(t,e,n){if(void 0===n&&(n=new Map),null===e)return n;for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<r;++i){var o=t.getActiveUniform(e,i);if(o){var a=t.getUniformLocation(e,o.name);a&&n.set(o.name,a)}}return n}function U(t,e,n){if(void 0===n&&(n=new Map),null===e)return n;for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;++i){var o=t.getActiveAttrib(e,i);o&&n.set(o.name,t.getAttribLocation(e,o.name))}return n}function j(t,e,n){var r=new _,i=["precision mediump int;","precision mediump float;"];return r.vs_src=i.concat(m(e)),r.fs_src=i.concat(m(n)),r.vs=F(t,r.vs_src,t.VERTEX_SHADER),r.fs=F(t,r.fs_src,t.FRAGMENT_SHADER),r.program=B(t,r.vs,r.fs),r.uniforms=L(t,r.program),r.attribs=U(t,r.program),r}function q(t,e,n,r,i){var o=new v;if(e instanceof Float32Array)o.type=t.FLOAT;else if(e instanceof Int8Array)o.type=t.BYTE;else if(e instanceof Uint8Array)o.type=t.UNSIGNED_BYTE;else if(e instanceof Int16Array)o.type=t.SHORT;else if(e instanceof Uint16Array)o.type=t.UNSIGNED_SHORT;else if(e instanceof Int32Array)o.type=t.INT;else{if(!(e instanceof Uint32Array))throw o.type=t.NONE,new Error;o.type=t.UNSIGNED_INT}return o.size=n,o.count=e.length/o.size,o.typed_array=e,o.buffer=t.createBuffer(),o.buffer_type=r,o.buffer_draw=i,t.bindBuffer(o.buffer_type,o.buffer),t.bufferData(o.buffer_type,o.typed_array,o.buffer_draw),o}function K(t,e){e.buffer===t.getParameter(t.ARRAY_BUFFER_BINDING)&&t.bindBuffer(t.ARRAY_BUFFER,null),t.deleteBuffer(e.buffer),e.buffer=null}function X(t,e,n,r,i,o){var a=new y;return a.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,a.texture),e&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),a}function G(t,e){e.texture===t.getParameter(t.TEXTURE_BINDING_2D)&&t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(e.texture),e.texture=null}function Y(t,e,n,r,i){if(void 0===i&&(i=0),t.bindBuffer(r.buffer_type,r.buffer),i>0)for(var o=r.typed_array.BYTES_PER_ELEMENT*r.size,a=o*i,s=0;s<i;++s){var c=o*s,h=e.attribs.get(n.replace(/{index}/g,s.toString()))||0;t.vertexAttribPointer(h,r.size,r.type,!1,a,c),t.enableVertexAttribArray(h)}else{h=e.attribs.get(n)||0;t.vertexAttribPointer(h,r.size,r.type,!1,0,0),t.enableVertexAttribArray(h)}}function W(t,e){e.attribs.forEach(function(e,n){-1!==e&&t.disableVertexAttribArray(e)})}e.vec4Identity=g,e.vec4CopyColor=x,e.vec4ApplyColor=function(t,e){return t[0]*=e.r,t[1]*=e.g,t[2]*=e.b,t[3]*=e.a,t},e.mat3x3Identity=w,e.mat3x3Copy=function(t,e){return t.set(e),t},e.mat3x3Ortho=function(t,e,n,r,i){var o=1/(e-n),a=1/(r-i);return t[0]*=-2*o,t[4]*=-2*a,t[6]+=(e+n)*o,t[7]+=(i+r)*a,t},e.mat3x3Translate=b,e.mat3x3RotateCosSin=k,e.mat3x3Rotate=E,e.mat3x3Scale=A,e.mat3x3Transform=function(t,e,n){var r=t[0]*e[0]+t[3]*e[1]+t[6],i=t[1]*e[0]+t[4]*e[1]+t[7],o=t[2]*e[0]+t[5]*e[1]+t[8],a=o?1/o:1;return n[0]=r*a,n[1]=i*a,n},e.mat3x3ApplySpace=function(t,e){return e&&(b(t,e.position.x,e.position.y),E(t,e.rotation.rad),A(t,e.scale.x,e.scale.y)),t},e.mat3x3ApplyAtlasPageTexcoord=T,e.mat3x3ApplyAtlasSiteTexcoord=M,e.mat3x3ApplyAtlasSitePosition=function(t,e){return e&&(A(t,1/e.original_w,1/e.original_h),b(t,2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y),A(t,e.w,e.h)),t},e.mat4x4Identity=P,e.mat4x4Copy=S,e.mat4x4Ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),c=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[5]=-2*c,t[10]=2*h,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(a+o)*h,t},e.mat4x4Translate=R,e.mat4x4RotateCosSinZ=I,e.mat4x4RotateZ=D,e.mat4x4Scale=O,e.mat4x4ApplySpace=C,e.mat4x4ApplyAtlasPageTexcoord=function(t,e){return e&&O(t,1/e.w,1/e.h),t},e.mat4x4ApplyAtlasSiteTexcoord=function(t,e){return e&&(R(t,e.x,e.y),-1===e.rotate?(R(t,0,e.w),I(t,0,-1)):1===e.rotate&&(R(t,e.h,0),I(t,0,1)),O(t,e.w,e.h)),t},e.mat4x4ApplyAtlasSitePosition=N,e.glCompileShader=F,e.glLinkProgram=B,e.glGetUniforms=L,e.glGetAttribs=U,e.glMakeShader=j,e.glDropShader=function(t,e){e.program===t.getParameter(t.CURRENT_PROGRAM)&&(W(t,e),t.useProgram(null)),t.deleteProgram(e.program),e.program=null},e.glMakeVertex=q,e.glDropVertex=K,e.glMakeTexture=X,e.glDropTexture=G,e.glSetupAttribute=Y,e.glResetAttribute=function(t,e,n,r,i){if(void 0===i&&(i=0),i>0)for(var o=0;o<i;++o){var a=e.attribs.get(n.replace(/{index}/g,o.toString()))||0;t.disableVertexAttribArray(a)}else a=e.attribs.get(n)||0,t.disableVertexAttribArray(a)},e.glResetAttributes=W},function(t,e,n){n(4),n(5),n(7),n(9)},function(t,e,n){(function(e){t.exports=e.Spine=n(1)}).call(this,n(0))},function(t,e,n){(function(e){t.exports=e.Atlas=n(6)}).call(this,n(0))},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(){this.name="",this.w=0,this.h=0,this.format="RGBA8888",this.min_filter="linear",this.mag_filter="linear",this.wrap_s="clamp-to-edge",this.wrap_t="clamp-to-edge"}}();e.Page=n;var r=function(){return function(t){this.x=0,this.y=0,this.w=0,this.h=0,this.rotate=0,this.offset_x=0,this.offset_y=0,this.original_w=0,this.original_h=0,this.index=-1,this.page=t}}();e.Site=r;var i=function(){function t(){this.pages=[],this.sites={}}return t.prototype.free=function(){this.pages=[],this.sites={}},t.prototype.import=function(t){return this.importAtlasText(t)},t.prototype.export=function(t){return void 0===t&&(t=""),this.exportAtlasText(t)},t.prototype.importAtlasText=function(t){var e=t.split(/\n|\r\n/);return this.importAtlasTextLines(e)},t.prototype.exportAtlasText=function(t){return void 0===t&&(t=""),t+this.exportAtlasTextLines([]).join("\n")},t.prototype.importAtlasTextLines=function(t){var e=this;this.pages=[],this.sites={};var i=null,o=null,a=null;return t.forEach(function(t){if(0===(u=t,u.replace(/^\s+|\s+$/g,"")).length)i=null,o=null;else if(a=t.match(/^size: (.*),(.*)$/)){if(!i)throw new Error;i.w=parseInt(a[1],10),i.h=parseInt(a[2],10)}else if(a=t.match(/^format: (.*)$/)){if(!i)throw new Error;i.format=a[1]}else if(a=t.match(/^filter: (.*),(.*)$/)){if(!i)throw new Error;i.min_filter=a[1],i.mag_filter=a[2]}else if(a=t.match(/^repeat: (.*)$/)){if(!i)throw new Error;var s=a[1];i.wrap_s="x"===s||"xy"===s?"Repeat":"ClampToEdge",i.wrap_t="y"===s||"xy"===s?"Repeat":"ClampToEdge"}else if(a=t.match(/^orig: (.*)[,| x] (.*)$/)){var c=parseInt(a[1],10),h=parseInt(a[2],10);console.log("page:orig",c,h)}else if(null===i)(i=new n).name=t,e.pages.push(i);else if(a=t.match(/^ {2}rotate: (.*)$/)){if(!o)throw new Error;o.rotate="true"===a[1]?-1:0}else if(a=t.match(/^ {2}xy: (.*), (.*)$/)){if(!o)throw new Error;o.x=parseInt(a[1],10),o.y=parseInt(a[2],10)}else if(a=t.match(/^ {2}size: (.*), (.*)$/)){if(!o)throw new Error;o.w=parseInt(a[1],10),o.h=parseInt(a[2],10)}else if(a=t.match(/^ {2}orig: (.*), (.*)$/)){if(!o)throw new Error;o.original_w=parseInt(a[1],10),o.original_h=parseInt(a[2],10)}else if(a=t.match(/^ {2}offset: (.*), (.*)$/)){if(!o)throw new Error;o.offset_x=parseInt(a[1],10),o.offset_y=parseInt(a[2],10)}else if(a=t.match(/^ {2}index: (.*)$/)){if(!o)throw new Error;o.index=parseInt(a[1],10)}else o&&(o.original_w=o.original_w||o.w,o.original_h=o.original_h||o.h),o=new r(i),e.sites[t]=o;var u}),this},t.prototype.exportAtlasTextLines=function(t){var e=this;return void 0===t&&(t=[]),this.pages.forEach(function(n){t.push(""),t.push(n.name),t.push("size: "+n.w+","+n.h),t.push("format: "+n.format),t.push("filter: "+n.min_filter+","+n.mag_filter);var r="none";"Repeat"===n.wrap_s&&"Repeat"===n.wrap_t?r="xy":"Repeat"===n.wrap_s?r="x":"Repeat"===n.wrap_t&&(r="y"),t.push("repeat: "+r),Object.keys(e.sites).forEach(function(r){var i=e.sites[r];i.page===n&&(t.push(r),t.push("  rotate: "+(0===i.rotate?"false":"true")),t.push("  xy: "+i.x+", "+i.y),t.push("  size: "+i.w+", "+i.h),t.push("  orig: "+i.original_w+", "+i.original_h),t.push("  offset: "+i.offset_x+", "+i.offset_y),t.push("  index: "+i.index))})}),t},t.prototype.importTpsText=function(t){return this.pages=[],this.sites={},this.importTpsTextPage(t,0)},t.prototype.importTpsTextPage=function(t,e){var i=this;void 0===e&&(e=0);var o=JSON.parse(t),a=this.pages[e]=new n;return o.meta&&(a.w=o.meta.size.w,a.h=o.meta.size.h,a.name=o.meta.image),Object.keys(o.frames||{}).forEach(function(t){var e=o.frames[t],n=i.sites[t]=new r(a);n.x=e.frame.x,n.y=e.frame.y,n.w=e.frame.w,n.h=e.frame.h,n.rotate=e.rotated?1:0,n.offset_x=e.spriteSourceSize&&e.spriteSourceSize.x||0,n.offset_y=e.spriteSourceSize&&e.spriteSourceSize.y||0,n.original_w=e.sourceSize&&e.sourceSize.w||n.w,n.original_h=e.sourceSize&&e.sourceSize.h||n.h}),this},t}();e.Data=i},function(t,e,n){(function(e){t.exports=e.RenderCtx2D=n(8)}).call(this,n(0))},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(2),o=function(){function t(t){this.images=new r.Map,this.skin_map=new r.Map,this.region_vertex_position=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.region_vertex_texcoord=new Float32Array([0,1,1,1,1,0,0,0]),this.region_vertex_triangle=new Uint16Array([0,1,2,0,2,3]),this.ctx=t}return t.prototype.loadData=function(t,e,n){var r=this;void 0===e&&(e=null),this.images=n,t.iterateSkins(function(e,n){var i=r.skin_map.get(e)||r.skin_map.set(e,new a);n.iterateAttachments(function(e,n,o,a){if(a){var p=i.slot_map.get(e)||i.slot_map.set(e,new s);switch(a.type){case"region":p.attachment_map.set(o,new c(r).loadData(t,a));break;case"boundingbox":p.attachment_map.set(o,new h(r).loadData(t,a));break;case"mesh":p.attachment_map.set(o,new u(r).loadData(t,a));break;case"weightedmesh":p.attachment_map.set(o,new l(r).loadData(t,a));break;case"path":p.attachment_map.set(o,new f(r).loadData(t,a))}}})})},t.prototype.dropData=function(t,e){var n=this;void 0===e&&(e=null),this.images.clear(),t.iterateSkins(function(e,r){var i=n.skin_map.get(e);r.iterateAttachments(function(e,n,r,o){if(o){var a=i&&i.slot_map.get(e),s=a&&a.attachment_map.get(r);s&&s.dropData(t,o)}})}),this.skin_map.clear()},t.prototype.updatePose=function(t,e){var n=this;t.iterateAttachments(function(r,i,o,a,s){if(s){var c=n.skin_map.get(t.skin_key),h=n.skin_map.get("default"),u=c&&c.slot_map.get(r)||h&&h.slot_map.get(r),l=u&&u.attachment_map.get(a);l&&l.updatePose(t,e,r,a,s)}})},t.prototype.drawPose=function(t,e){var n=this,r=this.ctx;this.updatePose(t,e),t.iterateAttachments(function(i,o,a,s,c){if(c){var h=n.skin_map.get(t.skin_key),u=n.skin_map.get("default"),l=h&&h.slot_map.get(i)||u&&u.slot_map.get(i),f=l&&l.attachment_map.get(s);if(f){switch(r.save(),r.globalAlpha*=o.color.a,o.blend){default:case"normal":r.globalCompositeOperation="source-over";break;case"additive":r.globalCompositeOperation="lighter";break;case"multiply":r.globalCompositeOperation="multiply";break;case"screen":r.globalCompositeOperation="screen"}f.drawPose(t,e,o,s,c),r.restore()}}})},t.prototype.drawDebugPose=function(t,e){var n=this,r=this.ctx;this.updatePose(t,e),t.iterateAttachments(function(r,i,o,a,s){if(s){var c=n.skin_map.get(t.skin_key),h=n.skin_map.get("default"),u=c&&c.slot_map.get(r)||h&&h.slot_map.get(r),l=u&&u.attachment_map.get(a);l&&l.drawDebugPose(t,e,i,a,s)}}),t.iterateBones(function(t,e){r.save(),p(r,e.world_space),_(r),r.restore()}),g(r,t.data,t.bones)},t.prototype.drawDebugData=function(t,e){var n=this,r=this.ctx;t.data.iterateAttachments(t.skin_key,function(r,i,o,a,s){if(s){var c=n.skin_map.get(t.skin_key),h=n.skin_map.get("default"),u=c&&c.slot_map.get(r)||h&&h.slot_map.get(r),l=u&&u.attachment_map.get(a);l&&l.drawDebugData(t,e,i,a,s)}}),t.data.iterateBones(function(t,e){r.save(),p(r,e.world_space),_(r),r.restore()}),g(r,t.data,t.data.bones)},t}();e.RenderCtx2D=o;var a=function(){return function(){this.slot_map=new r.Map}}(),s=function(){return function(){this.attachment_map=new r.Map}}(),c=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e){return this},t.prototype.dropData=function(t,e){return this},t.prototype.updatePose=function(t,e,n,r,i){},t.prototype.drawPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r],c=s&&s.page,h=c&&c.name||i.path||i.name||r,u=this.render.images.get(h);u&&u.complete&&(o.save(),a&&p(o,a.world_space),p(o,i.local_space),d(o,s),o.scale(i.width/2,i.height/2),y(o,this.render.region_vertex_triangle,this.render.region_vertex_position,this.render.region_vertex_texcoord,u,s),o.restore())},t.prototype.drawDebugPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r];o.save(),a&&p(o,a.world_space),p(o,i.local_space),d(o,s),o.beginPath(),o.rect(-i.width/2,-i.height/2,i.width,i.height),o.fillStyle="rgba(127,127,127,0.25)",o.fill(),o.strokeStyle="rgba(127,127,127,1.0)",o.stroke(),o.restore()},t.prototype.drawDebugData=function(t,e,n,r,i){var o=this.render.ctx,a=t.data.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r];o.save(),a&&p(o,a.world_space),p(o,i.local_space),d(o,s),o.beginPath(),o.rect(-i.width/2,-i.height/2,i.width,i.height),o.fillStyle="rgba(127,127,127,0.25)",o.fill(),o.strokeStyle="rgba(127,127,127,1.0)",o.stroke(),o.restore()},t}(),h=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e){return this},t.prototype.dropData=function(t,e){return this},t.prototype.updatePose=function(t,e,n,r,i){},t.prototype.drawPose=function(t,e,n,r,i){},t.prototype.drawDebugPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key);o.save(),a&&p(o,a.world_space),o.beginPath();var s=0;i.vertices.forEach(function(t,e){1&e?o.lineTo(s,t):s=t}),o.closePath(),o.strokeStyle=i.color.toString(),o.stroke(),o.restore()},t.prototype.drawDebugData=function(t,e,n,r,i){var o=this.render.ctx,a=t.data.bones.get(n.bone_key);o.save(),a&&p(o,a.world_space),o.beginPath();var s=0;i.vertices.forEach(function(t,e){1&e?o.lineTo(s,t):s=t}),o.closePath(),o.strokeStyle=i.color.toString(),o.stroke(),o.restore()},t}(),u=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e){return this.vertex_count=e.vertices.length/2,this.vertex_position=new Float32Array(e.vertices),this.vertex_texcoord=new Float32Array(e.uvs),this.vertex_triangle=new Uint16Array(e.triangles),this},t.prototype.dropData=function(t,e){return this},t.prototype.updatePose=function(t,e,n,i,o){var a=t.data.anims.get(t.anim_key),s=a&&a.ffd_skins&&a.ffd_skins.get(t.skin_key),c=s&&s.ffd_slots.get(n),h=c&&c.ffd_attachments.get(i),u=h&&h.ffd_timeline,l=u&&u.keyframes,f=r.Keyframe.find(l,t.time),p=f+1||f,d=l&&l[f],m=l&&l[p]||d,_=r.FfdKeyframe.interpolate(d,m,t.time);if(d&&m)for(var v=0;v<this.vertex_position.length;++v){var y=d.vertices[v-d.offset]||0,g=m.vertices[v-m.offset]||0;this.vertex_position[v]=o.vertices[v]+r.tween(y,g,_)}},t.prototype.drawPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r],c=s&&s.page,h=c&&c.name||i.path||i.name||r,u=this.render.images.get(h);u&&u.complete&&(o.save(),a&&p(o,a.world_space),d(o,s),y(o,this.vertex_triangle,this.vertex_position,this.vertex_texcoord,u,s),o.restore())},t.prototype.drawDebugPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r];o.save(),a&&p(o,a.world_space),d(o,s),v(o,this.vertex_triangle,this.vertex_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)"),o.restore()},t.prototype.drawDebugData=function(t,e,n,r,i){var o=this.render.ctx,a=t.data.bones.get(n.bone_key),s=e&&e.sites[i.path||i.name||r];o.save(),a&&p(o,a.world_space),d(o,s),v(o,this.vertex_triangle,this.vertex_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)"),o.restore()},t}(),l=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e){var n=this.vertex_count=e.uvs.length/2,i=this.vertex_setup_position=new Float32Array(2*n),o=this.vertex_blend_position=new Float32Array(2*n);this.vertex_texcoord=new Float32Array(e.uvs),this.vertex_triangle=new Uint16Array(e.triangles);for(var a=new r.Vector,s=0,c=0;s<n;++s){for(var h=e.vertices[c++],u=0,l=0,f=0;f<h;++f){var p=e.vertices[c++];a.x=e.vertices[c++],a.y=e.vertices[c++];var d=e.vertices[c++],m=t.bones.getByIndex(p);m&&r.Space.transform(m.world_space,a,a),u+=a.x*d,l+=a.y*d}var _=2*s;i[_++]=u,i[_++]=l}return o.set(i),this},t.prototype.dropData=function(t,e){return this},t.prototype.updatePose=function(t,e,n,i,o){var a=t.data.anims.get(t.anim_key),s=a&&a.ffd_skins&&a.ffd_skins.get(t.skin_key),c=s&&s.ffd_slots.get(n),h=c&&c.ffd_attachments.get(i),u=h&&h.ffd_timeline,l=u&&u.keyframes,f=r.Keyframe.find(l,t.time),p=f+1||f,d=l&&l[f],m=l&&l[p]||d,_=r.FfdKeyframe.interpolate(d,m,t.time);if(d&&m)for(var v=this.vertex_blend_position,y=new r.Vector,g=0,x=0,w=0;g<this.vertex_count;++g){for(var b=o.vertices[x++],k=0,E=0,A=0;A<b;++A){var T=o.vertices[x++];y.x=o.vertices[x++],y.y=o.vertices[x++];var M=o.vertices[x++],P=t.bones.getByIndex(T),S=d.vertices[w-d.offset]||0,R=m.vertices[w-m.offset]||0;y.x+=r.tween(S,R,_),++w;var I=d.vertices[w-d.offset]||0,D=m.vertices[w-m.offset]||0;y.y+=r.tween(I,D,_),++w,P&&r.Space.transform(P.world_space,y,y),k+=y.x*M,E+=y.y*M}v[2*g+0]=k,v[2*g+1]=E}else for(v=this.vertex_blend_position,y=new r.Vector,g=0,x=0;g<this.vertex_count;++g){for(b=o.vertices[x++],k=0,E=0,A=0;A<b;++A){T=o.vertices[x++];y.x=o.vertices[x++],y.y=o.vertices[x++];M=o.vertices[x++];(P=t.bones.getByIndex(T))&&r.Space.transform(P.world_space,y,y),k+=y.x*M,E+=y.y*M}var O=2*g;v[O++]=k,v[O++]=E}},t.prototype.drawPose=function(t,e,n,r,i){var o=this.render.ctx,a=e&&e.sites[i.path||i.name||r],s=a&&a.page,c=s&&s.name||i.path||i.name||r,h=this.render.images.get(c);h&&h.complete&&(o.save(),d(o,a),y(o,this.vertex_triangle,this.vertex_blend_position,this.vertex_texcoord,h,a),o.restore())},t.prototype.drawDebugPose=function(t,e,n,r,i){var o=this.render.ctx,a=e&&e.sites[i.path||i.name||r];o.save(),d(o,a),v(o,this.vertex_triangle,this.vertex_blend_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)"),o.restore()},t.prototype.drawDebugData=function(t,e,n,r,i){var o=this.render.ctx,a=e&&e.sites[i.path||i.name||r];o.save(),d(o,a),v(o,this.vertex_triangle,this.vertex_setup_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)"),o.restore()},t}(),f=function(){function t(t){this.render=t}return t.prototype.loadData=function(t,e){return this},t.prototype.dropData=function(t,e){return this},t.prototype.updatePose=function(t,e,n,r,i){},t.prototype.drawPose=function(t,e,n,r,i){},t.prototype.drawDebugPose=function(t,e,n,r,i){var o=this.render.ctx,a=t.bones.get(n.bone_key);o.save(),a&&p(o,a.world_space),o.beginPath();var s=0;i.vertices.forEach(function(t,e){1&e?o.lineTo(s,t):s=t}),o.closePath(),o.strokeStyle=i.color.toString(),o.stroke(),o.restore()},t.prototype.drawDebugData=function(t,e,n,r,i){var o=this.render.ctx,a=t.data.bones.get(n.bone_key);o.save(),a&&p(o,a.world_space),o.beginPath();var s=0;i.vertices.forEach(function(t,e){1&e?o.lineTo(s,t):s=t}),o.closePath(),o.strokeStyle=i.color.toString(),o.stroke(),o.restore()},t}();function p(t,e){e&&(t.translate(e.position.x,e.position.y),t.rotate(e.rotation.rad),t.scale(e.scale.x,e.scale.y))}function d(t,e){e&&(t.scale(1/e.original_w,1/e.original_h),t.translate(2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y),t.scale(e.w,e.h))}function m(t,e,n){void 0===e&&(e="grey"),void 0===n&&(n=1),t.beginPath(),t.arc(0,0,12*n,0,2*Math.PI,!1),t.strokeStyle=e,t.stroke()}function _(t,e,n){void 0===e&&(e="blue"),void 0===n&&(n=1),t.beginPath(),t.arc(0,0,12*n,0,2*Math.PI,!1),t.strokeStyle=e,t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(24*n,0),t.strokeStyle="red",t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,24*n),t.strokeStyle="green",t.stroke()}function v(t,e,n,r,i){void 0===r&&(r="grey"),void 0===i&&(i=""),t.beginPath();for(var o=0;o<e.length;){var a=2*e[o++],s=n[a],c=n[a+1],h=2*e[o++],u=n[h],l=n[h+1],f=2*e[o++],p=n[f],d=n[f+1];t.moveTo(s,c),t.lineTo(u,l),t.lineTo(p,d),t.lineTo(s,c)}i&&(t.fillStyle=i,t.fill()),t.strokeStyle=r,t.stroke()}function y(t,e,n,r,o,a){var s=a&&a.page,c=new Float32Array(9),h=new Float32Array(2);i.mat3x3Identity(c),o&&i.mat3x3Scale(c,o.width,o.height),i.mat3x3ApplyAtlasPageTexcoord(c,s),i.mat3x3ApplyAtlasSiteTexcoord(c,a);for(var u=0;u<e.length;){var l=2*e[u++],f=n.subarray(l,l+2),p=f[0],d=f[1],m=i.mat3x3Transform(c,r.subarray(l,l+2),h),_=m[0],v=m[1],y=2*e[u++],g=n.subarray(y,y+2),x=g[0],w=g[1],b=i.mat3x3Transform(c,r.subarray(y,y+2),h),k=b[0],E=b[1],A=2*e[u++],T=n.subarray(A,A+2),M=T[0],P=T[1],S=i.mat3x3Transform(c,r.subarray(A,A+2),h),R=S[0],I=S[1];t.save(),t.beginPath(),t.moveTo(p,d),t.lineTo(x,w),t.lineTo(M,P),t.closePath(),t.clip();var D=1/((k-=_)*(I-=v)-(R-=_)*(E-=v)),O=D*(I*(x-=p)-E*(M-=p)),C=D*(I*(w-=d)-E*(P-=d)),N=D*(k*M-R*x),F=D*(k*P-R*w),B=p-(O*_+N*v),L=d-(C*_+F*v);t.transform(O,C,N,F,B,L),o&&t.drawImage(o,0,0),t.restore()}}function g(t,e,n){e.ikcs.forEach(function(e,r){var i=n.get(e.target_key);switch(e.bone_keys.length){case 1:var o=n.get(e.bone_keys[0]);t.beginPath(),i&&t.moveTo(i.world_space.position.x,i.world_space.position.y),o&&t.lineTo(o.world_space.position.x,o.world_space.position.y),t.strokeStyle="yellow",t.stroke(),t.save(),i&&p(t,i.world_space),m(t,"yellow",1.5),t.restore(),t.save(),o&&p(t,o.world_space),m(t,"yellow",.5),t.restore();break;case 2:var a=n.get(e.bone_keys[0]),s=n.get(e.bone_keys[1]);t.beginPath(),i&&t.moveTo(i.world_space.position.x,i.world_space.position.y),s&&t.lineTo(s.world_space.position.x,s.world_space.position.y),a&&t.lineTo(a.world_space.position.x,a.world_space.position.y),t.strokeStyle="yellow",t.stroke(),t.save(),i&&p(t,i.world_space),m(t,"yellow",1.5),t.restore(),t.save(),s&&p(t,s.world_space),m(t,"yellow",.75),t.restore(),t.save(),a&&p(t,a.world_space),m(t,"yellow",.5),t.restore()}})}},function(t,e,n){(function(e){t.exports=e.RenderWebGL=n(2)}).call(this,n(0))}]);